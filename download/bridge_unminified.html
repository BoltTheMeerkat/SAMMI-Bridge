<!--For Extension info, read How to make extensions.txt in Extension folder-->
<!--Bridge V7.20-->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>SAMMI Bridge</title>
  <meta charset="utf-8">
  <meta name="title" content="SAMMI Bridge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="SAMMI component which allows SAMMI to connect to its extensions.">
  <meta name="keywords" content="SAMMI, Bridge, Twitch, Stream">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="language" content="English">
  <link rel="shortcut icon" type="image/x-icon"
href="https://raw.githubusercontent.com/SAMMISolutions/SAMMI-Bridge/main/favicon.ico"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/SAMMISolutions/SAMMI-Bridge@main/lib/bootstrap.min.css">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      font-family: 'Lato', sans-serif;
      background-color: #040b15;
    }
    h1 {
    font-size: calc(1.2em + 1vw);
    }
    a {
      color: #ffac7c;
      text-decoration: underline;
    }
    a:hover {
      color: #ff6810;
      text-decoration: underline;
    }
    .tslCollapse, .tslCollapse:hover, .tslCollapse a {
      text-decoration: none;
      color: #FFFFFF;
    }
    .tslCollapse.collapsed:before {
      content:'Show Options \01F847' ;
      width:15px;
    }
    .tslCollapse:before {
      content:'Hide Options \01F845' ;
      width:15px;
    }
    .SAMMITestTriggers .form-check-input[type=checkbox] {
      vertical-align: text-bottom;
    }
    #footer .tslCollapse.collapsed:before {
      content:'Show Tabs \01F847' ;
      width:15px;
    }
    #footer .tslCollapse:before {
      content:'Hide Tabs \01F845' ;
      width:15px;
    }

    #SAMMIcorelog {
      background:#040b15;
      padding:5px 15px;
      display:block;
      position: relative;
      float: left;
      text-align: left;
      max-height: 50%;
      overflow-y: auto;
    }

    #debugLogContent, #debugLog {
      border:none;
      background-color:rgba(0,0,0,0);
      box-shadow:none;
    }
    #debugLog .nav-link {
      padding: .2rem 1rem;
    }
    #SAMMIBridge {
      overflow: hidden;
      padding:5px;
      margin:2px;
      padding: 1px 
    }
    samp {
      width: 200px;
      word-break: break-all;
      white-space: normal;
    }

    input{
    padding:0px;
    margin:1px 1px
    }
    button{
    padding:2px 5px;
    margin:3px 0;
    box-shadow:2 2px #c5c5c5
    }
    button:active{
    background-color:#797979;
    color:#fff;
    box-shadow:0 0 rgb(223, 223, 223);
    transform:translateY(1px)
    }
    .nav {
      padding-left: 0;
      margin-bottom: 0;
    }
    .nav-pills .nav-link {
      font-family: Arial;
      padding: .4em .6em .1em .6em;
      margin: 2px 1px 0px 1px!important;
      background: rgb(175,177,184);
      background-color: linear-gradient(0deg, rgba(175,177,184,1) 15%, rgba(203,203,213,1) 61%);
      font-weight: bold;
      color:rgb(31, 32, 54);
      border-radius: 5px 5px 0px 0px;
      text-shadow: 0px 1px 2px rgb(195, 195, 195);
      transition: 0.01s;
    }
    .nav-pills > li > .nav-link.active {
      /*background-image: linear-gradient(to bottom, #E28B3B, #B96C23);*/
      background-image: linear-gradient(to bottom, #761a2c , #761a2c );
      border: 1px solid #761a2c;
      color: rgb(255, 255, 255);
      border: 1px solid #761a2c;
      text-shadow: 1px 1px 3px rgb(0 0 0 / 100%);
    }
    .nav-item
      {
        z-index: 998;
      }
    
    .tab-content {
      /*background-color: rgba(39, 55, 110, 0.5);*/
      background-color: rgba(22, 53, 100, 0.769);
      box-shadow: 0.5rem 0.5rem 0.5rem #00000080;
      min-height:50px;
      width:100%;
      border-radius:3px;
      overflow:hidden;
      padding:20px;
    }
    .draggable-source--is-dragging {
      opacity: 0;
    }

    @media (max-width: 576px) {
      .nav-pills .nav-link {
          border-radius: 5px 5px 0px 0px;
          font-weight:bold;
          padding: .2em .4em .1em .4em;
          font-size: 0.92em 
    }
      button{
        font-size:0.93em;
          padding:2px 5px;
        margin:3px 0;
        box-shadow:2 2px #c5c5c5
    }
    button:active{
        background-color:#797979;
        color:#fff;
        box-shadow:0 0 rgb(223, 223, 223);
        transform:translateY(1px)
    }
    }

    .btn-primary {
      background-color: #535861b5;
      border-color: rgb(72 78 89);

    }

    .btn-primary:hover {
      background-color: #60646ad9;
      border-color: #60646ad9

    }

    .notabs>.tab-pane {
      display: block !important;
      opacity: 1 !important;
    }
    .notabs button, .notabs input{
    color:#fff;
    background-color:#4c4c4c;
    border-color:#464546
    }

    #close-tab-button {
      display: none;
      position: absolute;
      top: 0%;  /* adjust this to position the button lower or higher */
      left: 50%;
      transform: translateX(-50%);
      font-size: 40px;
      color: rgba(255, 255, 255, 0.9);
      background-color: rgba(5, 11, 20, 0.9);
      padding: 10px;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      line-height: 40px;
      text-align: center;
      z-index: 9998; /* Ensure it overlays other elements */
      pointer-events: auto
    }

    #close-tab-button.hovered {
      color: rgba(255, 0, 0, 0.9);
    }


    .connected{
    color:#4ad84a
    }
    .disconnected{
    color:#fb4848
    }

    .opacity-90{
    opacity:0.9
    }

    @keyframes shake {
      0% { transform: translate(0, 0) rotate(0deg); }
      20% { transform: translate(0, 0) rotate(-3deg); }
      40% { transform: translate(0, 0) rotate(3deg); }
      60% { transform: translate(0, 0) rotate(-3deg); }
      80% { transform: translate(0, 0) rotate(3deg); }
      100% { transform: translate(0, 0) rotate(0deg); }
    }

    .shaking {
      animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) infinite both;
      transform-origin: center center;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 class="text-center mt-1">SAMMI Bridge </h1>
<!-- Connection Info -->
<div class="row justify-content-center">
    <div class="col col-auto">
        <svg id="toclient_circle" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red"
            class="bi bi-circle-fill d-md-none me-1" viewBox="0 0 16 16">
            <circle cx="8" cy="8" r="8" />
        </svg>
        <span>SAMMI Core</span><span class="d-none d-md-inline-flex me-1">: </span><span id="toclient"
            class="disconnected d-none d-md-inline-flex">Not connected.</span>
    </div>
    <div class="col col-auto">
        <i id="extensions_icon" class="fas fa-times-circle d-md-none me-1"></i>
        <span>Extensions</span><span class="d-none d-md-inline-flex me-1">: </span><span id="extensions_status"
            class="d-none d-md-inline-flex">No extensions installed.</span>
    </div>
</div>
<br>
<!-- Modal -->
<div class="modal fade" id="sammiModalElem" tabindex="-1" aria-labelledby="sammiModalElemLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sammiModalElemTitle">SAMMI</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="sammiModalElemContent">
          ..
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
<!--Tabs -->
<span id="close-tab-button">
    &times;
  </span>  
<div class="row justify-content-center g-0">
    <ul class="nav nav-pills mb-0" id="extensions-tab" role="tablist">
</div>
<!-- Tab Content -->
<div class="tab-content" id="extensions-tabContent">
    <div class="tab-pane" id="content-settings" role="tabpanel" title="Settings" data-type="settings">
  <div class='row pt-3'>
    <h5>Bridge Connection</h5>
    <div class="fs-7 mb-3"><span class="me-2">Version:</span><span name="version"></span></div>
    <div class="col">
      <div class="row">
        <label for="inputPassword" class="col-sm-5 col-form-label">IP Address:</label>
        <div class="col-sm-4 w-auto">
          <input type="text" id="nIPbox" name="nIPbox" value='127.0.0.1' class="form-control form-control-sm">
        </div>
      </div>
      <div class="row">
        <label for="inputPassword" class="col-sm-5 col-form-label">Port:</label>
        <div class="col-sm-4 w-auto">
          <input type="number" min="0" max="65535" id="nPortBox" name="nPortBox" value=9425
            class="form-control form-control-sm">
        </div>
      </div>
      <div class="row">
        <label for="inputPassword" class="col-sm-5 col-form-label">Password (optional):</label>
        <div class="col-sm-4 w-auto">
          <input id="nPassBox" type="password" name="nPassBox" size="20" value='' class="form-control form-control-sm">
        </div>
      </div>
      <div class="mt-1 row">
        <button type="button" id="cnctbutton" class="btn btn-primary btn-sm mb-2 w-auto ms-3">Connect</button>
      </div>
    </div>
  </div>
  <div class='row pt-3 d-block'>
    <h5>Message Logging</h5>
    <div class='pl-5 ml-5'>
       <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="dbgBridge" onclick="SAMMIDebugLog(this)" >
          <label class="form-check-label"for="flexSwitchCheckDefault">SAMMI</label>
       </div>
       <div class="tab-content p-0 mt-2" id="debugLogContent">
          <!--SAMMI Core Log-->
          <div class="tab-pane fade show active" id="SAMMIBridge" role="tabpanel" aria-labelledby="SAMMIBridge-tab" >
             <div id="SAMMIcorelog" class="col col-10 text-wrap">Logging is disabled.</div>
          </div>
       </div>
    </div>
 </div>
</div>
    <div class="tab-pane non-draggable" id="content-extensions" role="tabpanel" title="Extensions" data-type="default">
    <div class='row pt-3'>
        <h5>Extensions</h5>
    </div>
    <div class="table-responsive">
        <table class="table table-sm table-hover table-dark" id="extensionTable" style="color: #afb1b8;">
            <thead style="background-color: #182b50;">
                <tr>
                    <th class="pl-5 d-none d-sm-table-cell">Name</th>
                    <th class="pl-5">Author</th>
                    <th class="pl-5">
                      <span class="d-none d-sm-inline">Current</span>
                      <i class="fas fa-clock d-sm-none"></i>
                    </th>
                    <th class="pl-5">
                      <span class="d-none d-sm-inline">Latest</span>
                      <i class="fas fa-rocket d-sm-none"></i>
                    </th>
                    <th class="pl-5">
                      <span class="d-none d-sm-inline">Download</span>
                      <i class="fas fa-download d-sm-none"></i>
                    </th>
                </tr>
            </thead>
            <tbody id="extensionTableBody">
            </tbody>
        </table>
    </div>
  </div>
    <!--Twitch Triggers-->
<div class="tab-pane" id="content-triggers" role="tabpanel" title="Twitch Triggers" data-type="default">
   <form id="SAMMITestTwitchFollow" class="SAMMITestTriggers">
    <div class="form-check ps-0 d-flex align-items-center">
        <button type="submit" class="btn btn-primary btn-sm me-1">Test Follower</button>
        <label class="form-check-label me-1">Username:</label>
        <input type="text" class="form-control form-control-sm w-auto me-2" name="name">
    </div>
</form>
   <form id="SAMMITestTwitchSubs" class="SAMMITestTriggers">
   <button type="submit" class="btn btn-primary btn-sm me-1">Test Sub</button>
   <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidesubs" role="button" aria-expanded="false"
      aria-controls="hidesubs"></a>
   <div class="collapse" id="hidesubs">
      <div class="form-group">
         <label>Username:</label>
         <input type="text" class="form-control form-control-sm w-auto" name="name">
      </div>
      <div class="form-group mb-2">
         <label>Tier:</label>
         <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" name="tier" value="Tier 1" checked>
            <label class="form-check-label">Tier 1</label>
         </div>
         <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" name="tier" value="Tier 2">
            <label class="form-check-label">Tier 2</label>
         </div>
         <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" name="tier" value="Tier 3">
            <label class="form-check-label">Tier 3</label>
         </div>
         <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" name="tier" value="Prime">
            <label class="form-check-label">Prime</label>
         </div>
      </div>
      <div class="form-group mb-2">
         <label>Gift Options:</label>
         <div class="form-check form-check-inline">
            <input type="checkbox" class="form-check-input" name="subgift" value="subgift">
            <label class="form-check-label">SubGift</label>
         </div>
         <div class="form-check form-check-inline">
            <input type="checkbox" class="form-check-input" name="anongift" value="anongift">
            <label class="form-check-label">AnonGift</label>
         </div>
      </div>
      <div class="form-group mb-2">
         <label>Months:</label>
         <input type="number" class="form-control form-control-sm w-auto" min="1" max="999" name="submonths" value=1>
      </div>
      <div class="form-group mb-2">
         <label>Message:</label>
         <input type="text" class="form-control form-control-sm w-75" name="submessage">
      </div>
   </div>
</form>

   <form id="SAMMITestTwitchSubGift" class="SAMMITestTriggers">
    <div class="form-group d-flex align-items-center">
        <button type="submit" class="btn btn-primary btn-sm me-1">Test Subs Gift Amount</button>
        <label class="me-2">Amount:</label>
        <input type="number" class="form-control form-control-sm w-auto" min="1" max="999" name="subGiftAmount" value=1>
    </div>
</form>

   <form id="SAMMITestTwitchBits" class="SAMMITestTriggers">
   <button type="submit" class="btn btn-primary btn-sm me-1">Test Bits</button>
   <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidebits" role="button" aria-expanded="false"
      aria-controls="hidebits"></a>
   <div class='collapse' id="hidebits">
      <div class="form-check ps-0 d-flex align-items-center mb-2">
        <label class="form-check-label me-1">Username:</label>
        <input type="text" name="name" class="form-control form-control-sm w-auto me-2" value=""> 
      </div>
      <div class="form-check ps-0 d-flex align-items-center mb-2">
        <label class="form-check-label me-1">Amount of bits:</label>
        <input type="number" min="1" max="99999" name="bitsamount" class="form-control form-control-sm w-auto me-2" value=10>
      </div>
      <div class="form-check ps-0 d-flex align-items-center mb-2">
        <label class="form-check-label me-1">Total bits:</label>
        <input type="number" min="1" max="99999" name="bitstotal" class="form-control form-control-sm w-auto me-2" value=100>
      </div>
      <div class="form-check ps-0 d-flex align-items-center mb-2">
        <label class="form-check-label me-1">Message:</label>
        <textarea name="bitsmessage" class="form-control form-control-sm w-75" rows="1" style="margin:5px 0px;">Hello World!</textarea>
      </div>
   </div>
</form>

   <form id="SAMMITestTwitchPoints" class="SAMMITestTriggers">
   <div>
      <button type="submit" class="btn btn-primary btn-sm me-1">Test Channel Points</button>
      <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidepoints" role="button" aria-expanded="false"
         aria-controls="hidebits"></a>
   </div>
   <div class="collapse" id="hidepoints">
      <div class="form-group mb-2">
         <label>Username:</label>
         <input type="text" class="form-control form-control-sm w-auto" name="name">
      </div>
      <div class="form-group mb-2">
         <label>Redeem Name:</label>
         <input type="text" class="form-control form-control-sm w-auto mb-1" name="channelPointsName">
      </div>
      <div class="form-group mb-2">
         <label>Redeem Cost:</label>
         <input type="number" class="form-control form-control-sm w-auto" min="1" max="9999" name="channelPointsCost" value=50>
      </div>
      <div class="form-group mb-2">
         <label>Redeem Message:</label>
         <textarea class="form-control form-control-sm w-75" name="channelPointsMsg"></textarea>
         <div class="form-check">
            <input type="checkbox" class="form-check-input" name="channelPointsInput">
            <label class="form-check-label">User Input Required</label>
         </div>
      </div>
   </div>
</form>
   <form id="SAMMITestTwitchRaid" class="SAMMITestTriggers">
   <button type="submit" class="btn btn-primary btn-sm me-1">Test Raid</button>
   <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hideraid" role="button" aria-expanded="false"
   aria-controls="hideraid"></a>
   <div class="collapse" id="hideraid">
      <div class="form-group mb-2">
         <label>Username:</label>
         <input type="text" class="form-control form-control-sm w-auto" name="name">
      </div>
      <div class="form-group mb-2">
         <label>Amount:</label>
         <input type="number" class="form-control form-control-sm w-auto" min="1" max="999" name="raidAmount" value=5>
      </div>
   </div>
</form>
   <form id="SAMMITestTwitchPoll" class="SAMMITestTriggers form-inline">
   <div class="form-group d-flex align-items-center">
   <button type="submit" class="btn btn-primary btn-sm me-2">Test Poll</button>
   <select class="form-select-sm w-auto me-2" style="height:30px" aria-label="Poll Type" name="pollType">
      <option value="begin" selected>Created</option>
      <option value="progress">Voted</option>
      <option value="end">Ended</option>
      <option value="archive">Archived</option>
    </select>
    <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidepoll" role="button" aria-expanded="false"
    aria-controls="hidepoll"></a>
</div>
<div class="collapse mt-2 mb-1" id="hidepoll">
   Choice amount:
   <input class="mb-2" type="number" min="2" max="5" name="pollChoiceAmount" value=3> <br>
   Duration:
   <input class="mb-2" type="number" min="1" max="3600" name="pollDuration" value=60> <br>
   <input type="checkbox"
      class="form-check-input" name="pollAllowPoints"> Allow Channel Points
</div>
</form>

   <form id="SAMMITestTwitchPrediction" class="form-inline SAMMITestTriggers">
   <div class="form-group d-flex align-items-center">
      <button type="submit" class="btn btn-primary btn-sm me-2">Test Prediction</button>
      <select class="form-select form-select-sm w-auto me-2" aria-label="Poll Type" name="predictType">
         <option value="begin" selected>Created</option>
         <option value="progress">Voted</option>
         <option value="end">Locked</option>
         <option value="archive">Resolved</option>
      </select>
   </div>
   <div class="collapse" id="hideprediction">
      <div class="form-group mb-2">
         <label>Outcome amount:</label>
         <input type="number" class="form-control form-control-sm" min="2" max="10" name="predictChoiceAmount" value=3>
      </div>
      <div class="form-group mb-2">
         <label>Duration:</label>
         <input type="number" class="form-control form-control-sm" min="1" max="3600" name="predictionDuration" value=60>
      </div>
   </div>
</form>
   <form id="SAMMITestTwitchHypeTrain" class="SAMMITestTriggers">
   <div class="d-flex align-items-center">
      <button type="submit" class="btn btn-primary btn-sm me-2">Test Hype Train</button>
      <select class="form-select form-select-sm w-auto me-2" aria-label="Hype Train Type" name="hypeTrainType">
         <option value="approaching" selected>Approaching</option>
         <option value="started">Started</option>
         <option value="updated">Updated</option>
         <option value="progressed">Progressed</option>
         <option value="levelup">Leveled Up</option>
         <option value="ended">Ended</option>
         <option value="cdexpired">Cooldown Expired</option>
      </select>
      <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidehypetrain" role="button" aria-expanded="false"
         aria-controls="hidebits"></a>
   </div>
   <div class="collapse mb-1" id="hidehypetrain">
      <div class="form-group mb-2">
         <label>Current level:</label>
         <input type="number" class="form-control form-control-sm w-auto" min="2" max="50" name="hypeTrainLevel" value=3>
      </div>
      <div class="form-group mb-2">
         <label>(Updated/Progressed) Display Name:</label>
         <input type="text" class="form-control form-control-sm w-auto" name="hypeTrainName">
      </div>
      <div class="form-group mb-2">
         <label>(Updated/Progressed) Source:</label>
         <select class="form-select form-select-sm w-auto" aria-label="Hype Train Source" name="hypeTrainSource">
            <option value="BITS" selected>BITS</option>
            <option value="SUBS">SUBS</option>
         </select>
      </div>
      <div class="form-group mb-2">
         <label>Amount:</label>
         <input type="number" class="form-control form-control-sm w-auto" min="1" max="10000" name="hypeTrainAmount" value=100>
      </div>
      <div class="form-group mb-2">
         <label>(Ended) Ending reason:</label>
         <select class="form-select form-select-sm w-auto" aria-label="Hype Train Ended Reason" name="hypeTrainEndReason">
            <option value="COMPLETED" selected>COMPLETED</option>
            <option value="EXPIRED">EXPIRED</option>
         </select>
      </div>
   </div>
</form>
   <form id="SAMMITestTwitchShoutout" class="SAMMITestTriggers">
   <div class="form-group d-flex align-items-center">
       <button type="submit" class="btn btn-primary btn-sm me-1">Test Shoutout</button>
       <label class="me-2">Username:</label>
       <input type="text" class="form-control form-control-sm w-auto" id="name">
   </div>
</form>
   <form id="SAMMITestTwitchChat" class="SAMMITestTriggers">
    <div>
        <button type="submit" class="btn btn-primary btn-sm me-1">Test Chat Message </button>
        <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#hidechatmsg" role="button" aria-expanded="false"
            aria-controls="hidechatmsg"></a>
    </div>
    <div class="collapse" id="hidechatmsg">
        <div class="form-check ps-0 d-flex align-items-center mb-2">
             <label class="form-check-label me-1">Username:</label>
             <input type="text" class="form-control form-control-sm w-auto me-2" name="name">
        </div>
        <div class="form-check ps-0 d-flex align-items-center mb-2">
             <label class="form-check-label me-1">Message:</label>
             <textarea class="form-control form-control-sm w-75" name="chatMsg">Hello World</textarea>
        </div> 
       <input type="checkbox" class="form-check-input" name="chatFirstTime"> 1st Message<br>
       <input type="checkbox" class="form-check-input" name="chatBroadcaster"> Broadcaster 
       <input type="checkbox" class="form-check-input" name="chatMod"> Mod 
       <input type="checkbox" class="form-check-input" name="chatSub"> Subscriber 
       <input type="checkbox" class="form-check-input" name="chatVip"> VIP 
       <input type="checkbox" class="form-check-input" name="chatFounder"> Founder <br>
       Subscriber Tier:
       <select name="chatMsgSubTier">
           <option value="1">1</option>
           <option value="2">2</option>
           <option value="3">3</option>
       </select>
       Month: <input type="number" min=0 max=12 maxlength="2"
           oninput="javascript: if (parseInt(this.value) > parseInt(this.max)) this.value = this.max;"
           name="chatMsgSubMonth" value=1>
   </div>
</form>


</div>
    <!--YouTube Triggers-->
<div class="tab-pane" id="content-yttriggers" role="tabpanel" title="YouTube Triggers" data-type="default">
    <div>
        <h5>YouTube Live Test Triggers</h5>
    </div>
    <div class="align-middle align-items-center">
        <div>
    <button style="margin-right:10px;" type="button" class="btn btn-primary btn-sm" id="ytLiveTestSub">Test Subscriber</button>
</div>
        <div>
    <button style="margin-right:10px;" type="button"
        class="btn btn-primary btn-sm" id="ytLiveTestMember">Test
        Member</button>
    </div>
        <div>
    <div class="btn-group align-items-center">
        <button style="margin-right:10px;" type="button" class="btn btn-primary btn-sm" id="ytLiveTestMilestone">Test Member Renewal</button>
        <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#YTLiveHideMilestone" role="button"
            aria-expanded="false" aria-controls="HideMilestone"></a>
    </div> <br>
    <div class="collapse" id="YTLiveHideMilestone">
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Level name:</label>
            <input type="text" class="form-control form-control-sm w-auto  me-2" id="YTLiveMilestoneLevel">
            <label class="form-check-label me-1">Months:</label>
            <input type="number" class="form-control form-control-sm w-auto" min="1" max="99" id="YTLiveMilestoneMonth">
        </div>
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Message:</label>
            <textarea type="text" rows="1" class="form-control form-control-sm w-75" id="YTLiveMilestoneMsg"></textarea>
        </div>
    </div>
</div>
        <div>
    <div class="btn-group align-items-center">
        <button style="margin-right:10px;" type="button" class="btn btn-primary btn-sm" id="ytLiveTestSuperChat">Test Super Chat</button>
        <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#YTLiveHideSuperChat" role="button"
            aria-expanded="false" aria-controls="HideSuperChat"></a>
    </div> <br>
    <div class="collapse" id="YTLiveHideSuperChat">
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Amount:</label>
            <input type="number" min="1" max="100000" class="form-control form-control-sm w-auto  me-2"
                id="YTLiveSuperChatAmount">
            <label class="form-check-label me-1">Tier:</label>
            <input type="number" class="form-control form-control-sm w-auto" min="1" max="9" id="YTLiveSuperChatTier">
        </div>
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Message:</label>
            <textarea type="text" rows="1" class="form-control form-control-sm w-75" id="YTLiveSuperChatMsg"></textarea>
        </div>
    </div>
</div>
        <div>
    <div class="btn-group align-items-center">
        <button style="margin-right:10px;" type="button" class="btn btn-primary btn-sm" id="ytLiveTestSuperSticker">Test Super Sticker</button>
        <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#YTLiveHideSuperSticker" role="button"
            aria-expanded="false" aria-controls="HideSuperSticker"></a>
    </div> <br>
    <div class="collapse" id="YTLiveHideSuperSticker">
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Amount:</label>
            <input type="number" min="1" max="100000" class="form-control form-control-sm w-auto  me-2"
                id="YTLiveSuperStickerAmount">
        </div>
    </div>
</div>
        <div>
    <div class="btn-group align-items-center">
        <button style="margin-right:10px;" type="button" class="btn btn-primary btn-sm" id="ytLiveTestChatMessage">Test Chat Message</button>
        <a class="tslCollapse collapsed" data-bs-toggle="collapse" href="#YTLiveHideChatMessage" role="button"
            aria-expanded="false" aria-controls="HideChatMessage"></a>
    </div> <br>
    <div class="collapse" id="YTLiveHideChatMessage">
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Display Name:</label>
            <input type="text" class="form-control form-control-sm w-auto me-2" id="YTLiveChatMessageName">
        </div>
        <div class="form-check ps-0 d-flex align-items-center">
            <label class="form-check-label me-1">Message:</label>
            <textarea type="text" rows="1" class="form-control form-control-sm w-75"
                id="YTLiveChatMessageMsg"></textarea>
        </div>
        <input type="checkbox" id="YTLiveChatMessageBroadcaster"> Broadcaster
        <input type="checkbox" id="YTLiveChatMessageMod"> Mod
        <input type="checkbox" id="YTLiveChatMessageMember"> Member
        <input type="checkbox" id="YTLiveChatMessageVerified"> Verified
    </div>
</div>
    </div>
</div>
    <!--Your external script will be inserted here-->
    <!--<script src="example.js"></script>-->
    <!--INSERT PART 1-->
</div>
<div class="row justify-content-center mt-3 px-2 mb-5" id="footer"> <a class="tslCollapse collapsed"
    data-bs-toggle="collapse" href="#installedextensions" role="button" aria-expanded="false"
    aria-controls="installedextensions"></a>
  <span class='collapse' id="installedextensions"></span>
  <span id='extensions-tab-buttons' class="mt-2">
    <button id="extensionsshow" class="btn btn-primary btn-sm me-1">Show All Tabs</button> <button id="extensionshide"
      class="btn btn-primary btn-sm me-1">Hide All Tabs</button> <button id="extensionsresetorder"
      class="btn btn-primary btn-sm me-1">Reset Tab Order</button> <button onclick="location.reload()"
      class="btn btn-primary btn-sm me-1">Refresh</button></span>
</div>
  </div>

<script>
/* eslint-disable */  
(function() {
  "use strict";
/* eslint-disable */
// Twitch client ID to use for Twitch API requests
window.TWITCH_CLIENT_ID = 'xolexwv18o8i5uqsga0bw3z39cpg0c';
// init object with all available SAMMI command methods
const SAMMI = new SAMMICommands();
window.SAMMI = SAMMI;
const LB = SAMMI;
window.LB = LB;
// Expose debug and sammiModal functions for global access
window.logIt = null; 
window.sammiModal = null; 
// SAMMI global object with variables
const SAMMIVars = {
  SAMMIdebug: JSON.parse(localStorage.getItem('SAMMIdebug')) || {},
  twitchList: {},
  force_close: false,
  box_newline: 0,
  box_checkbox: 2,
  box_obs_scenes: 4,
  box_obs_sources: 5,
  box_obs_filters: 6,
  box_keyboard: 7,
  box_compare: 8,
  box_math: 9,
  cbox_sound: 10,
  box_slider: 11,
  box_normal: 14,
  box_variable: 15,
  box_color: 17,
  box_selectvalue: 18,
  box_selectstring: 19,
  box_selectstringwritable: 20,
  box_loadfile: 22,
  box_imagefile: 23,
  box_twitch_reward: 24,
  box_nobox: 30,
  box_obs_pull: 32,
  box_select_deck: 33,
  box_password: 34,
  box_twitch_account: 35,
};
window.SAMMIVars = SAMMIVars;
const LBVars = SAMMIVars;
window.LBVars = LBVars;


/** SAMMI Core Helper Functions
 * You can call them with SAMMI.{helperfunction}
 * Use promises if you want to get a reply back from SAMMI
 * No promise example: SAMMI.setVariable(myVariable, 'some value', 'someButtonID')
 * Promise example: SAMMI.getVariable(myVariable, 'someButtonID').then(reply=>console.log(reply))
 */
function SAMMICommands() {
  const SendCommand = {
    /**
     * Get a variable from SAMMI
     * @param {string} name - name of the variable
     * @param {string} buttonId - button ID for local variable, default = global variable
     */
    async getVariable(name = '', buttonId = 'global') {
      return sendToSAMMI('GetVariable', {
        Variable: name,
        ButtonId: buttonId,
      });
    },

    /**
     * Set a variable in SAMMI
     * @param {string} name - name of the variable
     * @param {(string|number|object|array|null)} value - new value of the variable
     * @param {string} buttonId - button ID for local variable, default = global variable
     */
    async setVariable(name = '', value = '', buttonId = 'global', instanceId = 0) {
      instanceId = !isNaN(instanceId) ? parseInt(instanceId) : 0;
      return sendToSAMMI('SetVariable', {
        Variable: name,
        Value: value,
        ButtonId: buttonId,
        instanceId,
      });
    },

    /**
     * Send a popup message to SAMMI
     * @param {string} msg - message to send
     */
    async popUp(msg = '') {
      return sendToSAMMI('PopupMessage', {
        Message: msg,
      });
    },

    /**
     * Send a yellow notification message to SAMMI
     * @param {string} msg - message to send
     */
    async alert(msg = '') {
      return sendToSAMMI('AlertMessage', {
        Message: msg,
      });
    },

    /**
     * send extension command to SAMMI
     * @param {string} name - name of the extension command
     * @param {string} color - box color, accepts hex/dec colors (include # for hex), default 3355443
     * @param {string} height - height of the box in pixels, 52 for regular or 80 for resizable box, default 52
     * @param {Object} boxes
     * - one object per box, key = boxVariable, value = array of box params
     * - boxVariable = variable to save the box value under
     * - boxName = name of the box shown in the user interface
     * - boxType = type of the box, 0 = resizable, 2 = checkbox (true/false), 14 = regular box, 15 = variable box, 18 = select box, see extension guide for more
     * - defaultValue = default value of the variable
     * - (optional) sizeModifier = horizontal box size, 1 is normal
     * - (optional) [] selectOptions = array of options for the user to select (when using Select box type)
     * @param {[boxName: string, boxType: number, defaultValue: (string | number), sizeModifier: (number|undefined), selectOptions: Array|undefined]} boxes.boxVariable
     * */
    async extCommand(name = '', color = 3355443, height = 52, boxes = {}, triggerButton = false, hidden = false) {
      const ext = new SammiConstructExtCommand(name, color, height, triggerButton, hidden);

      for (const [key, value] of Object.entries(boxes)) {
        ext.addBox(key, value);
      }

      return sendToSAMMI('SendExtensionCommands', {
        Data: [ext],
      });
    },

    /**
     * Close SAMMI Bridge connection to SAMMI Core.
     */
    async close() {
      return sendToSAMMI('Close');
    },

    /**
     * Get deck and button updates
     * @param {boolean} enabled - enable or disable updates
     */
    async stayInformed(enabled) {
      return sendToSAMMI('SetStayInformed', {
        Enabled: enabled,
      });
    },

    /**
     * Request an array of all decks
     * - Replies with an array ["Deck1 Name","Unique ID",crc32,"Deck2 Name","Unique ID",crc32,...]
     * - Use crc32 value to verify deck you saved localy is the same
     */
    async getDeckList() {
      return sendToSAMMI('GetDeckList');
    },

    /**
     * Request a deck params
     * @param {string} id - Unique deck ID retrieved from getDeckList
     * - Replies with an object containing a full deck
     */
    async getDeck(id = 0) {
      return sendToSAMMI('GetDeck', {
        UniqueId: id,
      });
    },

    /**
     * Get deck status
     * - Replies with either 0 (deck is disabled) or 1 (deck is enabled)
     * @param {string} id - Unique deck ID retrieved from getDeckList
     */
    async getDeckStatus(deckID = 0) {
      return sendToSAMMI('getDeckStatus', {
        deckID,
      });
    },

    /**
     * Change deck status
     * @param {string} id - Unique deck ID retrieved from getDeckList
     * @param {int} status - New deck status, 0 = disable, 1 = enable, 2 = toggle
     */
    async changeDeckStatus(deckID = 0, status = 1) {
      return sendToSAMMI('changeDeckStatus', {
        deckID,
        status,
      });
    },

    /**
     * Retrieve an image in base64
     * @param {string} fileName - image file name without the path (image.png)
     * - Replies with an object containing the Base64 string of the image
     */
    async getImage(fileName = '') {
      return sendToSAMMI('GetImage', {
        FileName: fileName,
      });
    },

    /**
     * Retrieves CRC32 of a file
     * @param {string} fileName - file name without the path (image.png)
     */
    async getSum(fileName = '') {
      return sendToSAMMI('GetSum', {
        Name: fileName,
      });
    },

    /**
     * Retrieves all currently active buttons
     * - Replies with an array of button param objects
     */
    async getActiveButtons() {
      return sendToSAMMI('GetOngoingButtons');
    },

    /**
     * Retrieves params of all linked Twitch accounts
     */
    async getTwitchList() {
      return sendToSAMMI('GetTwitchList');
    },

    /**
     * Sends a trigger
     * @param {number} type - type of trigger
     * - trigger types: 0 Twitch chat, 1 Twitch Sub, 2 Twitch Gift, 3 Twitch redeem
     * 4 Twitch Raid, 5 Twitch Bits, 6 Twitch Follower, 7 Hotkey
     * 8 Timer, 9 OBS Trigger, 10 SAMMI Bridge, 11 twitch moderation, 12 extension trigger
     * @param {object} data - whatever data is required for the trigger, see manual
     */
    async trigger(type = -1, data = { trigger_data: {} }) {
      return sendToSAMMI('SendTrigger', {
        Type: type,
        Data: data,
      });
    },

    /**
     * Sends a test trigger that will automatically include channel ID for from_channel_id pull value
     * @param {number} type - type of trigger
     * - trigger types: 0 Twitch chat, 1 Twitch Sub, 2 Twitch Gift, 3 Twitch redeem
     * 4 Twitch Raid, 5 Twitch Bits, 6 Twitch Follower, 7 Hotkey
     * 8 Timer, 9 OBS Trigger, 10 SAMMI Bridge, 11 twitch moderation, 12 extension trigger
     * @param {object} data - whatever data is required for the trigger, see manual
     */
    async testTrigger(type, data) {
      return sendToSAMMI('SendTestTrigger', {
        Type: type,
        Data: data,
      });
    },

    /**
     * Triggers a button
     * @param {string} id - button ID to trigger
     */
    async triggerButton(id = '') {
      return sendToSAMMI('TriggerButton', {
        ButtonId: id,
      });
    },

    /**
     * Releases a button
     * @param {string} id - button ID to release
     */
    async releaseButton(id = '') {
      return sendToSAMMI('ReleaseButton', {
        ButtonId: id,
      });
    },

    /**
     * Modifies a button
     * @param {string} id - button ID to modify
     * @param {number|undefined} color - decimal button color (BGR)
     * @param {string|undefined} text - button text
     * @param {string|undefined} image - button image file name
     * @param {number|undefined} border - border size, 0-7
     * - leave parameters empty to reset button back to default values
     */
    async modifyButton(id, color, text = '', image, border) {
      return sendToSAMMI('ModifyButton', {
        ButtonId: id,
        Data: {
          color: color || undefined,
          text: text || undefined,
          image: image || undefined,
          border: border || undefined,
        },
      });
    },

    /**
     * Retrieves all currently modified buttons
     * - object of button objects that are currently modified
     */
    async getModifiedButtons() {
      return sendToSAMMI('GetModifications');
    },

    /**
     * Sends an extension trigger
     * @param {string} trigger - name of the trigger
     * @param {object} dats - object containing all trigger pull data
     */
    async triggerExt(trigger = '', data = {}) {
      return sendToSAMMI('ExtensionTrigger', {
        Trigger: trigger,
        Data: data,
      });
    },

    /**
     * Deletes a variable
     * @param {string} name - name of the variable
     * @param {string} buttonId - button ID for local variable, default = global variable
     */
    async deleteVariable(name = '', buttonId = 'global') {
      return sendToSAMMI('DeleteVariable', {
        Variable: name,
        ButtonId: buttonId,
      });
    },

    /**
     * Inserts an array value
     * @param {string} arrayName - name of the array
     * @param {number} index - index to insert the new item at
     * @param {string|number|object|array} value - item value
     * @param {string} buttonId - button id, default is global
     */
    async insertArray(arrayName = '', index = 0, value = '', buttonId = 'global') {
      return sendToSAMMI('InsertArrayValue', {
        Array: arrayName,
        Slot: index,
        Value: value,
        ButtonId: buttonId,
      });
    },

    /**
     * Deletes an array value at specified index
     * @param {string} arrayName - name of the array
     * @param {number} index - index of the item to delete
     * @param {string} buttonId - button id, default is global
     */
    async deleteArray(arrayName = '', slot = 0, buttonId = 'global') {
      return sendToSAMMI('DeleteArraySlot', {
        Array: arrayName,
        Slot: slot,
        ButtonId: buttonId,
      });
    },

    /**
     * Sends a notification (tray icon bubble) message to SAMMI
     * @param {string} msg - message to show
     */
    async notification(msg = '') {
      return sendToSAMMI('NotificationMessage', {
        Message: msg,
      });
    },
    generateMessage() {
      const messages = [
        'All that glitters is not gold. Fair is foul, and foul is fair Hover through the fog and filthy air. These violent delights have violent ends. Hell is empty and all the devils are here. By the pricking of my thumbs, Something wicked this way comes. Open, locks, Whoever knocks!',
        'Hello World!',
        "Alright, I'll be honest with ya, Bob. My name's not Kirk. It's Skywalker. Luke Skywalker.",
        'Well, that never happened in any of the simulations.',
        'You know, you blow up one sun and suddenly everyone expects you to walk on water.',
        "How's a needle in my butt gonna get water out of my ears?",
        'If you immediately know the candle light is fire, then the meal was cooked a long time ago.',
        'In the middle of my backswing!?',
        'If I am to remain in this body, I must shave my head.',
        "I remembered something. There's a man. He is bald and wears a short sleeve shirt. And somehow, he is important to me… I think his name is… Homer.",
        'Alright, we came here in peace, we expect to go in one... piece.',
        'It costs nearly a billion dollars just to turn the lights on around here',
        "You wouldn't believe the things you can make from the common, simple items lying around your planet... which reminds me, you're going to need a new microwave.",
        'Welcome, ye knights of the round table, men of honor, followers of the path of righteousness. Only those with wealth of knowledge and truth of spirit shall be given access to the underworld, the storehouse of riches of Ambrosius Aurelianus. Prove ye worthy, and all shall be revealed.',
      ];
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      return randomMessage;
    },
  };

  async function sendToSAMMI(command, data) {
    const res = await sammiclient.send(command, data);
    return res;
  } // construct extension command object

  class SammiConstructExtCommand {
    constructor(name, color, height, triggerButton = false, hidden = false) {
      let p = 0;
      this.name = name;
      this.color = color;
      this.height = height;
      this.triggerButton = triggerButton;
      this.hidden = hidden;

      this.addBox = (boxVar, params) => {
        this[`ud_t${p}`] = boxVar;
        this[`ud_n${p}`] = params[0];
        this[`ud${p}`] = params[1];
        this[`ud_d${p}`] = params[2];
        this[`ud_m${p}`] = params[3] || undefined;
        this[`ud_o${p}`] = params[4] || undefined;

        p += 1;
      };
    }
  }

  return SendCommand;
}


window.addEventListener('load', function () {
// Instantiate SAMMICore and SAMMIUI, and setup socket connection...
const sammiclient = new SAMMIWebSocket();
window.sammiclient = sammiclient
window.lioranboardclient = sammiclient
const sammiCore = new SAMMICore();
const sammiUI = new SAMMIUI();

// Add event listener for the connection button
document.querySelector('#cnctbutton').addEventListener('click', () => {
  sammiCore.connectButton();
});

// Initialize SAMMIUI
sammiUI.initModal();
sammiUI.initTabs();
populateExtensionTable();

// Get Bridge Version
getVersionFromHTML();

// Initiate Twitch Test triggers
SAMMITestTriggers();
}, false);

// Initiate YouTube Test triggers
YTLiveTestEvent();

// Create a new SAMMIUI class
class SAMMIUI {
  // Constructor function initializes the object with properties
  constructor() {
    // Fetch the DOM elements and localStorage items required
    this.modalElem = document.getElementById('sammiModalElem');
    this.installedExt = document.querySelector('#installedextensions');
    this.ul = document.getElementById('extensions-tab');
    this.parent = document.getElementById('extensions-tabContent');
    this.tabList = {};
    this.tabSortList = JSON.parse(localStorage.getItem('bridge_tabsSortList')) || [];
    this.newTabSortList = [];
    this.tabsVisibility = JSON.parse(localStorage.getItem('bridge_tabsVisibility')) || {};
    this.lastActiveTab = localStorage.getItem('bridge_tabsActive') || 'content-settings';
  }

  // This method initializes the modal used by SAMMI Core to call Bridge
  initModal() {
    window.sammiModal = new bootstrap.Modal(this.modalElem, {});
  }

  // Hiding tabs by dragging them over the close X button
  static dragXHide(draggable, classInstance) {
    // Initializing variables for drag timer, close button and drag source
    let dragTimer = null;
    let overCloseButton = false;
    let currentDraggedSource = null;
    const closeButton = document.getElementById('close-tab-button');

    // Event Listener for mouse entering the close button
    closeButton.addEventListener('mouseenter', () => {
      overCloseButton = true;
      closeButton.classList.add('hovered');
      const mirror = document.querySelector('.draggable-mirror');
      mirror?.classList.add('shake');
    });

    // Event Listener for mouse leaving the close button
    closeButton.addEventListener('mouseleave', () => {
      overCloseButton = false;
      closeButton.classList.remove('hovered');
      const mirror = document.querySelector('.draggable-mirror');
      mirror?.classList.remove('shake');
    });

    // Event Listener for creation of mirror image while dragging
    draggable.on('mirror:created', (event) => {
      event.mirror.style.zIndex = '9999';
    });

    // Event Listener for the start of dragging
    draggable.on('drag:start', (event) => {
      const mirror = document.querySelector('.draggable-mirror');
      mirror?.classList.remove('shaking');
      // Start a timer when the drag starts
      dragTimer = setTimeout(() => {
        // If the user is still dragging after 0.5s, show the 'X'
        closeButton.style.display = 'block';
      }, 50);
      currentDraggedSource = event.data.source;
    });

    // Event Listener for dragging movement
    draggable.on('drag:move', (event) => {
      const mirror = document.querySelector('.draggable-mirror');
      const movementY = event.sensorEvent.data.originalEvent.movementY;
      if (overCloseButton && mirror) {
        mirror.classList.add('opacity-90');
        mirror.firstChild.classList.add('shaking');
      } else if (mirror) {
        mirror.classList.remove('opacity-90');
        mirror.firstChild.classList.remove('shaking');
      }

      if (movementY > 0) {  // If the user moves the drag item downwards, hide the 'X' and clear the timer
        closeButton.style.display = 'none';
        if (dragTimer !== null) {
          clearTimeout(dragTimer);
          dragTimer = null;
        }
      } else if (movementY < 0) {  // If the user moves the drag item upwards, show the 'X' again
        closeButton.style.display = 'block';
        if (dragTimer === null) {
          // Start the timer again if it was cleared
          dragTimer = setTimeout(() => {
            closeButton.style.display = 'block';
          }, 500);
        }
      }
    });

    // Event Listener for the end of dragging
    draggable.on('drag:stop', () => {
      const mirror = document.querySelector('.draggable-mirror');
      mirror?.firstChild.classList.remove('shaking');

      // Hide the 'X' when the drag ends
      closeButton.style.display = 'none';
      // Clear the timer
      if (dragTimer !== null) {
        clearTimeout(dragTimer);
        dragTimer = null;
      }

      // If the tab was dropped on the 'X', hide it
      if (overCloseButton) {
        const draggedElement = document.querySelector('.draggable--original');
        draggedElement.classList.add('d-none');
        document.getElementById(`checkbox${draggedElement.children[0].id.slice(0, -4)}`).checked = false; // Uncheck the checkbox
        classInstance.saveTabsVisibility();  // save tabs visibility
      }
      currentDraggedSource = null; // Reset the stored id
    });

    // Event Listener for dropping of the draggable item
    draggable.on('dropped', (event) => {
      // If the tab is dropped on the 'X', hide it
      if (event.sensorEvent.target.id === 'close-tab-button') {
        event.source.style.display = 'none';
      }
    });
  } 


  // This method initializes tabs
  initTabs() {
    // Ensures that the last active tab is the one that will be displayed first
    this.lastActiveTab = document.getElementById(this.lastActiveTab) ? this.lastActiveTab : 'content-settings';

    // Select all tab panes and sort them into default and added content
    const contentLi = this.parent.querySelectorAll('.tab-pane');
    const contentAll = Array.from(contentLi).filter((n) => n.parentNode.closest('.tab-pane') === this.parent.closest('.tab-pane'));

    // Separate default and added content
    const defaultContent = contentAll.filter((e) => e.dataset.type === 'default' || e.dataset.type === 'settings');
    const addedContent = contentAll.filter((e) => e.dataset.type !== 'default').reverse();

    // Reassemble content in the correct order
    const content = [...defaultContent, ...addedContent];

    // Set the active tab
    document.getElementById(this.lastActiveTab).className = 'tab-pane active';

    // For each piece of content, create an extension tab and box
    content.forEach((e) => {
      e.id = e.id.replace(/^[^a-z]+|[^\w:.-]+/g, '');
      this.createExtensionTab(e);
      if (e.dataset.type !== 'settings' && e.id != 'content-extensions') this.createExtensionBox(e);
    });

    // Sort the tabs according to the sort list
    this.sortTabs();

    // Update tab sort list and save it in localStorage
    this.tabSortList = this.newTabSortList;
    localStorage.setItem('bridge_tabsSortList', JSON.stringify(this.newTabSortList));

    // Add draggable functionality to the tabs
    const draggable = new Draggable.Sortable(this.ul, {
      draggable: 'li:not(.non-draggable)', // exclude non-draggable tabs
      distance: 1,
      sortAnimation: {
        duration: 200,
        easingFunction: 'ease-in-out',
      },
      plugins: [Draggable.Plugins.SortAnimation],
    });

    // Call the SAMMITabDragXHide method with the draggable instance
    SAMMIUI.dragXHide(draggable, this);

    // Save the tab order when the sorting ends
    draggable.on('sortable:stop', (e) => {
      const sortArr = this.tabSortList || [];
      sortArr.splice(e.newIndex +2, 0, sortArr.splice(e.oldIndex + 2, 1)[0]);
      localStorage.setItem('bridge_tabsSortList', JSON.stringify(sortArr));
      this.tabSortList = sortArr;
    });

    // Update the tab visibility when a checkbox is clicked
    this.installedExt.onclick = (ev) => {
      if (ev.target.value) {
        const id = ev.target.id.slice(8);
        if (id === 'content-settings' || id === 'content-extensions') return;
        const li = document.querySelector(`[aria-controls="${id}"]`);

        ev.target.checked ? li.classList.remove('d-none') : li.classList.add('d-none');
        this.saveTabsVisibility();
      }
    };

    // The following event listeners reset various elements to their default state
    document.querySelector('#extensionsshow').onclick = () => {
      localStorage.removeItem('bridge_tabsVisibility');
      window.location.reload();
    };

    document.querySelector('#extensionshide').onclick = () => {
      const tabsVisibility = {};
      document.querySelectorAll('#installedextensions input[type=checkbox]').forEach((e) => {
        const id = e.id.slice(8);
        tabsVisibility[id] = false;
      });
      localStorage.setItem('bridge_tabsVisibility', JSON.stringify(tabsVisibility));
      window.location.reload();
    };

    document.querySelector('#extensionsresetorder').onclick = () => {
      localStorage.removeItem('bridge_tabsSortList');
      window.location.reload();
    };

    // Save the last active tab when a button is clicked
    this.ul.querySelectorAll('button').forEach((btn) => {
      btn.onclick = (btn) => {
        localStorage.setItem('bridge_tabsActive', btn.target.id.slice(0, -4));
      };
    });
  }

  // This method creates the extension tabs
  createExtensionTab(e) {
    // DOM manipulation to create the required elements
    const li = document.createElement('li');
    const button = document.createElement('button');
    const closeButton = document.createElement('span');
    closeButton.innerHTML = 'X';
    closeButton.style.display = 'none';
    closeButton.classList.add('close-tab-button');
    button.appendChild(closeButton);

    // Set the attributes and content of the created elements
    const hide = this.tabsVisibility[e.id] === false ? 'd-none' : '';
    const active = this.lastActiveTab === e.id ? 'active' : '';

    li.setAttribute('class', 'nav-item');
    li.setAttribute('role', 'presentation');
    // Determine if the element should be draggable
    if (e.id !== 'content-settings' && e.id !== 'content-extensions') {
      li.setAttribute('draggable', 'true');
      button.setAttribute('draggable', 'true');
    } else {
      li.classList.add('non-draggable');
      button.classList.add('non-draggable');
    }

    button.setAttribute('class', `nav-link draggable-source ${active} ${hide}`);
    button.setAttribute('id', `${e.id}-tab`);
    button.setAttribute('data-bs-toggle', 'pill');
    button.setAttribute('data-bs-target', `#${e.id}`);
    button.setAttribute('type', 'button');
    button.setAttribute('role', 'tab');
    button.setAttribute('aria-controls', e.id);
    button.setAttribute('aria-selected', 'false');
    button.setAttribute('draggable', 'true');

    // verify data type and add icon to title
    let dataType = e.getAttribute('data-type');
    let title = e.title;
    
    // for default tabs included with bridge
    if (dataType === 'default') {
        title = `<i class="fa-solid fa-star me-1" title="Official SAMMI Tab"></i>${title}`;
    // for settings/status tab included with bridge
    } else if (dataType === 'settings') {
        title = `<i class="fa-solid fa-gear me-1" title="Official SAMMI Tab"></i>${title}`;
    // for official SAMMI extensions
    } else if (dataType === 'official') {
        title = `<i class="fa-solid fa-circle-check me-1" title="Official SAMMI Extension"></i>${title}`; // fa-solid fa-badge-check
    // for user created extensions
    } else if (!dataType || dataType === 'external') {
        // No icon to be added
    }

    button.innerHTML = title;
    li.appendChild(button);

    // Store the created tab in the tabList object
    this.tabList[e.id] = li;
  }

  // data-type

  // This method creates the extension boxes
    createExtensionBox(e) {
    // DOM manipulation to create the required elements
    const checkbox = document.createElement('input');
    const text = document.createElement('span');
    checkbox.type = 'checkbox';
    checkbox.id = `checkbox${e.id}`;
    checkbox.checked = !(this.tabsVisibility[e.id] === false);
    text.innerHTML = `${e.title}  `;
    text.prepend(checkbox);

    // Add the created elements to the installed extensions box
    this.installedExt.appendChild(text);
  }


  // This method sorts the tabs according to the sort list
  sortTabs() {
    while (Object.keys(this.tabList).length > 0) {
      const childId = this.tabSortList.shift() || Object.keys(this.tabList)[0];
      if (this.tabList[childId]) {
        this.ul.appendChild(this.tabList[childId]);
        this.newTabSortList.push(childId);
        delete this.tabList[childId];
      } else {
        // Handle missing tab (log error, etc.)
      }
    }
  }

  // This method saves the visibility status of tabs
  saveTabsVisibility() {
    const tabsVisibility = this.tabsVisibility || {};
    document.querySelectorAll('#installedextensions input[type=checkbox]').forEach((e) => {
      const id = e.id.slice(8);
      tabsVisibility[id] = e.checked;
    });
    localStorage.setItem('bridge_tabsVisibility', JSON.stringify(tabsVisibility));
    this.tabsVisibility = tabsVisibility;
  }
}
/* eslint-disable no-undef */
class SAMMICore {
  constructor() {
    // Grab elements from the DOM once and store references
    this.nIPbox = document.querySelector('#nIPbox');
    this.nPortBox = document.querySelector('#nPortBox');
    this.nPassBox = document.querySelector('#nPassBox');
    this.cnctButton = document.querySelector('#cnctbutton');

    // Get Browser Name
    this.browser = (() => {
      const test = (regexp) => regexp.test(window.navigator.userAgent);
      switch (true) {
        case test(/OBS/i): return 'OBS';
        case test(/edg/i): return 'Microsoft Edge';
        case test(/trident/i): return 'Microsoft Internet Explorer';
        case test(/firefox|fxios/i): return 'Mozilla Firefox';
        case test(/opr\//i): return 'Opera';
        case test(/ucbrowser/i): return 'UC Browser';
        case test(/samsungbrowser/i): return 'Samsung Browser';
        case test(/chrome|chromium|crios/i): return 'Google Chrome';
        case test(/safari/i): return 'Apple Safari';
        default: return 'Other';
      }
    })();

    // Load connection data and attempt to connect on instantiation
    this.loadConnection();
    this.connectToSAMMI();
  }

  loadConnection() {
    const ls = JSON.parse(localStorage.getItem('lsParams')) || {};
    this.nIPbox.value = ls.ip || '127.0.0.1';
    this.nPortBox.value = ls.port || 9425;
    this.nPassBox.value = ls.pass || '';
  }

  connectButton() {
    if (sammiclient && sammiclient._connected) {
      SAMMIVars.force_close = true;
      sammiclient.send('Close');
      sammiclient.disconnect();
      this.connectionStatus('toclient', 'disconnected', 'Connection Closed', 'red');
      this.cnctButton.innerText = 'Disconnecting';
    } else {
      console.log('SAMMI manually connected.');
      SAMMICore.tryClearWaitingTimeout();
      this.connectToSAMMI();
    }
  }

  static tryClearWaitingTimeout() {
    try {
      clearTimeout(SAMMIVars.waiting_to_connect);
    } catch (e) {}
  }

  // change connection status
  connectionStatus(id, status, text, fill) {
    document.getElementById(id).className = `${status} d-none d-md-inline-flex`;
    document.getElementById(id).innerHTML = ` ${text}`;
    document.getElementById(`${id}_circle`).setAttribute('fill', fill);
  }

  connectToSAMMI() {
    const debugBridge = document.querySelector('#dbgBridge');
    if (debugBridge) SAMMIDebugLog(debugBridge);

    SAMMICore.tryClearWaitingTimeout();

    const p = SAMMIVars;

    // CONNECT TO SAMMI
    sammiclient.connect({
      address: `${this.nIPbox.value}:${this.nPortBox.value}`,
      password: `${this.nPassBox.value}`,
      name: 'SAMMI Bridge',
    })
      .catch(() => {
        console.log('SAMMI Connection Error');
      });

    // CONNECTION OPENED
    sammiclient.on('ConnectionOpened', () => {
      this.cnctButton.innerText = 'Disconnect';
      console.log('SAMMI Connection opened!');
    });

    sammiclient.on('error', () => {
      sammiclient.disconnect();
    });

    // AUTH SUCCESSFUL
    sammiclient.on('AuthenticationSuccess', async () => {
      // Send all extension commands to SAMMI
      sendExtensionCommands(); // Get Twitch list for extension makers

      await SAMMI.getTwitchList().then((data) => {
        window.TWITCH_CLIENT_ID = data.twitch_list.clientId ? data.twitch_list.clientId : window.TWITCH_CLIENT_ID;
      });

      // Save connection params to storage
      const ls = {
        ip: this.nIPbox.value,
        port: this.nPortBox.value,
        pass: this.nPassBox.value,
      };
      localStorage.setItem('lsParams', JSON.stringify(ls));

      // set current browser as global variable
      SAMMI.setVariable('browser_name', this.browser);
      // send extension versions to SAMMI
      waitForExtensions().then(() => {
        SAMMI.setVariable('extensions', window.extensionVersions);
      });
      this.connectionStatus('toclient', 'connected', 'Connected', 'green');
      console.log('SAMMI Authentication successsful!');
    });

    // CONNECTION CLOSED
    sammiclient.on('ConnectionClosed', () => {
      SAMMICore.tryClearWaitingTimeout();
      sammiclient.removeAllListeners();

      // Attempt to reconnect if not manual disconnect
      if (!p.force_close) {
        this.connectionStatus(
          'toclient',
          'disconnected',
          'Disconnected, attempting to reconnect.',
          'red',
        );
        console.log('SAMMI disconnected. Attempting to reconnect in 5s.');
        p.waiting_to_connect = setTimeout(() => {
          this.connectToSAMMI();
        }, 5000);
      } else {
        console.log('SAMMI disconnected by user.');
        this.connectionStatus('toclient', 'disconnected', 'Connection Closed', 'red');
      }

      p.force_close = false;
      this.cnctButton.innerText = 'Connect';
    });

    // CONNECTION ERROR
    sammiclient.on('ConnectionError', () => {
      // Try to force close the connection
      try {
        sammiclient.disconnect();
      } catch (e) {}

      console.log('SAMMI connection error.');
    });

    // RELOAD SAMMI Bridge
    sammiclient.on('ResetPlease', () => {
      window.location.reload();
    });

    // PING SAMMI Bridge
    sammiclient.on('UserPing', () => {
      sammiModalElemTitle.innerHTML = 'SAMMI Core';
      sammiModalElemContent.innerHTML = 'Ping received!';
      if (!window.sammiModal) return;
      window.sammiModal.show();
      setTimeout(() => {
        window.sammiModal.hide();
      }, 10000);
      SAMMI.alert(`Ping Received. Your Bridge is running in the following browser: ${this.browser}.`);
    });

    // EXECUTE COMMAND
    sammiclient.on('ExecuteCommand', (json) => {
      SammiExtensionReceived(json.CommandName, json.Data);
    });
  }
}

// Function to fetch the JSON
async function getExtensionsData() {
  const response = await fetch('https://sammi.solutions/SAMMI-Bridge/extensions/extensions.json');
  const data = await response.json();
  return data.extensions;
}

// Function to get current installed extensions
function getCurrentExtensions() {
  const tabs = document.querySelectorAll('.tab-pane');
  const currentExtensions = [];
  tabs.forEach((tab) => {
    const tabTitle = tab.title.toLowerCase(); // Convert tab title to lowercase
    if (['twitch triggers', 'youtube triggers', 'extensions', 'settings'].includes(tabTitle) || tabTitle === '') return;
    currentExtensions.push({
      extension_name: tab.title,
      current_version: tab.getAttribute('data-version'),
    });
  });
  return currentExtensions;
}

async function populateExtensionTable() {
  const extensionData = await getExtensionsData();
  const currentExtensions = getCurrentExtensions();
  const tbody = document.getElementById('extensionTableBody');
  const extensionTable = document.getElementById('extensionTable');
  const versionSpan = document.getElementById('extensions_status');
  const extensionIcon = document.getElementById('extensions_icon');
  window.extensionVersions = {}; // Add this line to create a new object

  let allUpToDate = true; // Flag to track if all extensions are up to date

  // If there are no current extensions installed
  if (currentExtensions.length === 0) {
    const extensionTab = document.getElementById('content-extensions');
    // Remove the table
    extensionTable.style.display = 'none';

    // Create a paragraph element and set its text
    const p = document.createElement('p');
    p.innerText = 'No extensions installed.';

    // Append the paragraph to the body
    extensionTab.appendChild(p);

    versionSpan.innerText = 'No extensions installed.'; // Set the text of the version status
    return; // Exit the function
  }

  currentExtensions.sort((a, b) => a.extension_name.localeCompare(b.extension_name));

  currentExtensions.forEach((current) => {
    const latest = extensionData.find((e) => {
      const extensionNameMatch = e.extension_name.toLowerCase().trim() === current.extension_name.toLowerCase().trim();
      const alternateNamesMatch = e.alternate_names ? e.alternate_names.map((n) => n.toLowerCase().trim()).includes(current.extension_name.toLowerCase().trim()) : false;
      return extensionNameMatch || alternateNamesMatch;
    });
    const row = document.createElement('tr');

    // Create the cell for the extension name
    const nameCell = document.createElement('td');
    nameCell.innerText = current.extension_name;
    nameCell.style.cursor = 'pointer'; // make the cursor pointer
    nameCell.title = latest && latest.details.description ? latest.details.description : 'No description available'; // set tooltip text
    nameCell.addEventListener('click', () => {
      const tabId = `content-${current.extension_name.replace(/ /g, '_')}-tab`;
      const tabElement = document.getElementById(tabId);
      const bsTab = new bootstrap.Tab(tabElement);
      bsTab.show();
    });
    row.appendChild(nameCell);

    // Author cell
    const authorCell = document.createElement('td');
    authorCell.className = 'd-none d-sm-table-cell';
    authorCell.title = 'Extension Author';
    authorCell.innerText = latest ? latest.details.author : 'N/A';
    row.appendChild(authorCell);

    // Current version cell
    const currentVersionCell = document.createElement('td');
    currentVersionCell.title = 'Installed Version';
    currentVersionCell.innerText = current.current_version !== 'unknown' ? current.current_version : 'N/A';
    row.appendChild(currentVersionCell);

    // Latest version cell
    const latestVersionCell = document.createElement('td');
    latestVersionCell.title = 'Latest Version';
    latestVersionCell.innerText = latest ? latest.details.latest_version : 'N/A';
    row.appendChild(latestVersionCell);

    // save to object to send to SAMMI
    const extensionNameKey = toPascalCase(current.extension_name); // Convert extension name to Pascal Case key
    window.extensionVersions[extensionNameKey] = {
      latest: latest ? latest.details.latest_version : 'N/A',
      current: current.current_version,
    };

    // Download/Update cell
    const downloadCell = document.createElement('td');
    if (latest) {
      downloadCell.innerHTML = `
        <a href="${latest.details.download_link}" target="_blank" rel="noopener noreferrer" 
            class="btn btn-sm"
            style="${latest.details.latest_version !== current.current_version ? 'background-color: #a15900' : 'background-color: #0a8263'}">
            <span class="d-none d-sm-inline">${latest.details.latest_version !== current.current_version ? 'Update' : 'Download'}</span>
            <i class="fas fa-${latest.details.latest_version !== current.current_version ? 'sync' : 'download'} d-sm-none"></i>
        </a>
      `;
    } else {
      // place holder to maintain cell height
      downloadCell.innerHTML = `
          <a href="#" style="visibility: hidden;" class="btn btn-sm">
              <span class="d-none d-sm-inline">Placeholder</span>
              <i class="fas fa-sync d-sm-none"></i>
          </a>
      `;
    }
    row.appendChild(downloadCell);

    if (!latest) {
      row.style.backgroundColor = '#afab68';
      allUpToDate = false;
    } else if (latest.details.latest_version !== current.current_version) {
      allUpToDate = false;
    }
    tbody.appendChild(row);
  });

  if (allUpToDate) {
    extensionIcon.className = 'fas fa-check-circle me-1 d-md-none';
    extensionIcon.style.color = '#4ad84a';
    extensionIcon.title = 'Updates available';
    versionSpan.innerText = 'All up to date';
    versionSpan.style.color = '#4ad84a';
  } else {
    extensionIcon.className = 'fas fa-exclamation-circle me-1 d-md-none';
    extensionIcon.style.color = 'orange';
    extensionIcon.title = 'Updates available';
    versionSpan.innerText = 'Updates available';
    versionSpan.style.color = 'orange';
  }
}

function waitForExtensions() {
  return new Promise((resolve, reject) => {
    const checkExtensions = () => {
      // Check if window.extensionVersions is a populated array
      if (window.extensionVersions && typeof window.extensionVersions === 'object' && Object.keys(window.extensionVersions).length > 0) {
        setTimeout(() => {
          resolve();
        }, 500);
      } else {
        // If not, check again after 500 milliseconds
        setTimeout(checkExtensions, 500);
      }
    };
    checkExtensions();
  });
}
function toPascalCase(str) {
  return str
    .match(/[a-z]+/gi) // Match all groups of letters (ignores non-letter characters)
    .map((word) => word.charAt(0).toUpperCase() + word.substr(1).toLowerCase()) // Convert to Pascal Case
    .join('') // Join the groups of letters together
    .replace(/\s+/g, ''); // Remove any remaining spaces
}

// Fake Triggers testing
async function SAMMITestTriggers() {
  const processTrigger = {
    async SAMMITestTwitchFollow(form) {
  const [name, userID] = await getNameFromInput(form.elements.name);
  const pullData = {
    user_name: name.toLowerCase(),
    display_name: name,
    user_id: userID,
  };
  sendTriggerToSAMMI(
    6,
    `${pullData.display_name} followed you! [test trigger]`,
    {},
    pullData,
  );
}
,
    async SAMMITestTwitchSubs(form, notUsed, gifted = false, gifterName = '') {
  const type = 1;
  const month = parseInt(form.elements.submonths.value) || 1;
  const subtype = form.elements.subgift.checked
    ? 2
    : form.elements.anongift.checked
      ? 4
      : gifted
        ? 2
        : 1;
  const context = form.elements.subgift.checked
    ? 'subgift'
    : form.elements.anongift.checked
      ? 'anonsubgift'
      : gifted
        ? 'subgift'
        : month > 1 ? 'resub' : 'sub'
  let name; let userID;
  if (gifted) {
    name = gifterName;
  } else if (form.elements.anongift.checked) {
    name = ['Anonymous User'];
  } else {
    const [customName, customID] = await getNameFromInput(form.elements.name);
    name = [customName, customID];
  }
  const giftedName = subtype !== 1 ? generateName(name[0]) : [''];
  const message = form.elements.submessage.value || SAMMI.generateMessage();
  const tiers = form.querySelectorAll('input[name="tier"]');
  let selectedTier;

  for (const tier of tiers) {
    if (tier.checked) {
      selectedTier = tier.value;
    }
  }

  const selecterTierNum = selectedTier === 'Tier 1'
    ? 1
    : selectedTier === 'Tier 2'
      ? 2
      : selectedTier === 'Tier 3'
        ? 4
        : 8;
  const msg = subtype !== 1
    ? `${name[0]} gifted a sub to ${giftedName[0]}! [test trigger]`
    : `${name[0]} subscribed for ${month} months! [test trigger]`;
  const data = {
    tier: selecterTierNum,
    month,
    subtype,
    communitygift: gifted ? 1 : 0,
  };
  const pullData = {
    user_name: name[0].toLowerCase(),
    display_name: name[0],
    user_id: name[1],
    gifted_user_name: giftedName[0].toLowerCase(),
    gifted_display_name: giftedName[0],
    gifted_user_id: giftedName[1],
    tier: selectedTier,
    context,
    message,
    month,
    community_gift: gifted ? 1 : 0,
  };
  sendTriggerToSAMMI(type, msg, data, pullData);
}
,
    SAMMITestTwitchSubGift(form) {
  const subForm = document.getElementById('SAMMITestTwitchSubs');
  if (subForm.querySelector('[value="Prime"]').checked) subForm.querySelector('[value="tier1"]').checked = true;
  if (subForm.querySelector('[value="anongift"]').checked === false) subForm.querySelector('[value="subgift"]').checked = true;
  const tiers = subForm.querySelectorAll('input[name="tier"]');
  let selectedTier;

  for (const tier of tiers) {
    if (tier.checked) {
      selectedTier = tier.value;
    }
  }

  const selecterTierNum = selectedTier === 'Tier 1'
    ? 1
    : selectedTier === 'Tier 2'
      ? 2
      : selectedTier === 'Tier 3'
        ? 4
        : 1;
  const gifterName = subForm.querySelector('[value="anongift"]').checked
    ? ['Anonymous User']
    : generateName();
  const amount = parseInt(form.elements['subGiftAmount'].value) || 1;
  const pullData = {
    user_name: gifterName[0].toLowerCase(),
    display_name: gifterName[0],
    user_id: gifterName[1],
    amount: `${amount}`,
    tier: selectedTier,
  };
  sendTriggerToSAMMI(
    2,
    `${gifterName[0]} has gifted ${amount} subs! [test trigger]`,
    {
      tier: selecterTierNum,
      amount,
    },
    pullData,
  );

  for (let i = 0; i < amount; i++) {
    setTimeout(() => {
      this.SAMMITestTwitchSubs(subForm, null, true, gifterName);
    }, 1000 + i * 10);
  }
}
,
    async SAMMITestTwitchBits(form) {
  const [name, userID] = await getNameFromInput(form.elements.name);
  const amount = parseInt(form.elements.bitsamount.value) || 50;
  const totalAmount = parseInt(form.elements.bitstotal.value) || amount + 100;
  const message = form.elements.bitsmessage.value || SAMMI.generateMessage();
  const pullData = {
    user_name: name.toLowerCase(),
    // display_name: name, // bits don't display name
    user_id: userID,
    amount: amount,
    total_amount: totalAmount,
    message,

  };
  sendTriggerToSAMMI(
    5,
    `${pullData.user_name} donated ${amount} bits! [test trigger]`,
    {
      amount,
    },
    pullData,
  );
}
,
    async SAMMITestTwitchPoints(form) {
  const [name, userID] = await getNameFromInput(form.elements.name);
  const channelID = generateName[1];
  const redeemName = form.elements.channelPointsName.value || 'Test Reward';
  const userInput = form.elements.channelPointsInput.checked;
  const message = userInput
    ? form.elements.channelPointsMsg.value || SAMMI.generateMessage()
    : '';
  const cost = parseInt(form.elements.channelPointsCost.value) || 50;
  const image = 'https://static-cdn.jtvnw.net/custom-reward-images/default-4.png';
  const rewardId = generateUUID();
  const redeemId = generateUUID();
  const pullData = {
    user_name: name.toLowerCase(),
    display_name: name,
    user_id: userID,
    channel_id: channelID,
    redeem_name: redeemName,
    message,
    cost,
    image,
    reward_id: rewardId,
    redeem_id: redeemId,
  };
  sendTriggerToSAMMI(
    3,
    `${pullData.display_name} has redeemed ${redeemName}! [test trigger]`,
    {
      redeemname: redeemName,
      message,
      user_name: pullData.user_name,
    },
    pullData,
  );
}
,
    async SAMMITestTwitchRaid(form) {
  const [name, userID] = await getNameFromInput(form.elements.name);
  const amount = parseInt(form.elements.raidAmount.value) || 5;
  const pullData = {
    user_name: name.toLowerCase(),
    display_name: name,
    user_id: userID,
    amount,
  };

  sendTriggerToSAMMI(
    4,
    `${pullData.display_name} is raiding you with ${amount} viewers! [test trigger]`,
    {
      amount,
    },
    pullData,
  );
}
,
    SAMMITestTwitchPrediction(form) {
    const predictSelect = form.elements['predictType'];
    const amount = form.elements['predictChoiceAmount'].value || getRandomInt(2, 10);
    const duration = form.elements['predictionDuration'].value || getRandomInt(60, 600);
    const type = predictSelect.options[predictSelect.selectedIndex].text || 'Created';
    const typeNum = type === 'Created' ? 0 : type === 'Voted' ? 1 : type === 'Locked' ? 2 : 3;
    const baseData = {
      duration: parseInt(duration),
      outcome_amount: parseInt(amount),
      vote_total: type !== 'Created' ? getRandomInt(10, 300) : 0,
      event: type,
      prediction_id: '1621385a-1f26-4197-82fc-6352003a69db',
      prediction_name: 'My Test Prediction',
      winning_outcome: type === 'Resolved' ? `e960f614-d379-494a-8b45-0c7500978${getRandomInt(0, amount - 1)}ea` : '',
    };
    const pullData = populateWithOutcomeInfo(baseData, amount, type);

    sendTriggerToSAMMI(
      15,
      `Prediction ${type} [test trigger] fired!`,
      {
        type: typeNum,
      },
      pullData,
    );
}
,
    SAMMITestTwitchPoll(form) {
    const pollSelect = form.elements['pollType'];
    const amount = form.elements['pollChoiceAmount'].value || getRandomInt(2, 5);
    const duration = form.elements['pollDuration'].value || getRandomInt(60, 600);
    const type = pollSelect.options[pollSelect.selectedIndex].text || 'Created';
    const typeNum = type === 'Created' ? 0 : type === 'Voted' ? 1 : type === 'Ended' ? 2 : 3;
    const allowPoints = !!form.elements['pollAllowPoints'].checked;
    // total votes is 0 if the poll was just Created, else get random amount based on choices amount
    const voteTotal = (type !== 'Created') ? getRandomInt(amount, amount * 50) : 0;
    const baseData = {
      duration: parseInt(duration),
      event: type,
      poll_id: '9dd6a7a7-78f4-46ef-b674-e2864ad7fa07',
      poll_name: 'My Test Poll',
      choice_amount: parseInt(amount),
      vote_total: voteTotal,
      vote_total_base: 0,
      vote_total_bits: 0,
      vote_total_points: 0,
      top_vote_list: Array.from(Array(amount).keys()),
    };
    const pullData = populateWithChoiceInfo(baseData, amount, type, false, allowPoints, voteTotal);

    sendTriggerToSAMMI(
      16,
      `Poll ${type} [test trigger] fired!`,
      {
        type: typeNum,
      },
      pullData,
    );
}
,
    async SAMMITestTwitchHypeTrain(form) {
    const hypeSelect = form.elements['hypeTrainType'];
    const type = hypeSelect.options[hypeSelect.selectedIndex].text;
    const currentLevel = form.elements['hypeTrainLevel'].value || 1;
    const currentGoal = getRandomInt(1000, 2000);
    const goalProgres = getRandomInt(100, currentGoal - 50);
    const typeNums = {
      Approaching: 0, Started: 1, Updated: 2, 'Leveled Up': 3, Ended: 4, 'Cooldown Expired': 5, Progressed: 6,
    };
    const typeNum = typeNums[type];
    let baseObj = {};
    // base SAMMI trigger values are the same for the following types
    if (typeNum == 1 || typeNum == 3 || typeNum == 6) {
      baseObj = {
        current_level: parseInt(currentLevel),
        current_goal: currentGoal,
        goal_progress: goalProgres,
        total_progress: goalProgres,

      };
    }

    const hypeTrainId = `${getRandomInt(10, 99)}b8f628-5075-4213-95ac-6ceeac9426fe`;

    // this reward object is added to approaching events
    // not sure if it changes depending on the broadcaster
    const level_one_rewards = [{
      id: 'emotesv2_3114c3d12dc44f53810140f632128b54',
      reward_level: 0.0,
      group_id: '',
      token: 'HypeSleep',
      type: 'EMOTE',
      set_id: '1a8f0108-5aee-4125-8067-d39e983e934b',
    }, {
      id: 'emotesv2_7d457ecda087479f98501f80e23b5a04',
      reward_level: 0.0,
      group_id: 1,
      token: 'HypePat',
      type: 'EMOTE',
      set_id: '1a8f0108-5aee-4125-8067-d39e983e934b',
    }, {
      id: 'emotesv2_e7a6e7e24a844e709c4d93c0845422e1',
      reward_level: 0.0,
      group_id: '',
      token: 'HypeLUL',
      type: 'EMOTE',
      set_id: '1a8f0108-5aee-4125-8067-d39e983e934b',
    }, {
      id: 'emotesv2_e2a11d74a4824cbf9a8b28079e5e67dd',
      reward_level: 0.0,
      group_id: '',
      token: 'HypeCool',
      type: 'EMOTE',
      set_id: '1a8f0108-5aee-4125-8067-d39e983e934b',
    }, {
      id: 'emotesv2_036fd741be4141198999b2ca4300668e',
      reward_level: 0.0,
      group_id: '',
      token: 'HypeLove1',
      type: 'EMOTE',
      set_id: '1a8f0108-5aee-4125-8067-d39e983e934b',
    }];

    const progress = {
      remaining_seconds: typeNum !== 1 ? getRandomInt(10, 299) : 299,
      total: goalProgres,
      value: goalProgres,
      goal: currentGoal,
      level: {
        impressions: getRandomInt(100, 900),
        rewards: level_one_rewards,
        value: parseInt(currentLevel),
        goal: currentGoal,
      },
    };

    // types of all participations
    const particTypes = ['BITS.CHEER', 'BITS.EXTENSION', 'BITS.POLL', 'SUBS.TIER_2_SUB', 'SUBS.TIER_2_GIFTED_SUB', 'SUBS.TIER_1_GIFTED_SUB', 'SUBS.TIER_1_SUB', 'SUBS.TIER_3_SUB', 'SUBS.TIER_3_GIFTED_SUB'];
    let data;

    switch (type) {
      default:
        data = {};
        break;
      case 'Approaching': {
        // participants is an array of user IDs
        const participants = Array(getRandomInt(2, 10)).fill(generateName()[1]);
        data = {
          approaching_hype_train_id: hypeTrainId,
          channel_id: generateName()[1],
          goal: 3,
          is_boost_train: 0,
          participants,
          level_one_rewards,
          creator_color: '639315',
          // array of one single value? can it be more? probably..
          events_remaining_durations: [getRandomInt(50, 300)],
        };
      }
        break;
      case 'Started': {
        // started and updated at will be the same
        const started = Date.now();
        data = {
          id: hypeTrainId,
          channel_id: generateName()[1],
          started_at: started,
          updated_at: started,
          expires_at: started + 300000,
          ended_at: null,
          ending_reason: null,
          participations: {
            // get two random participation types and generate their values
            [particTypes[getRandomInt(0, 2)]]: getRandomInt(1, 1000),
            [particTypes[getRandomInt(3, 8)]]: getRandomInt(1, 10),
          },
          conductors: {},
          // this is supposed to return very long complex object, leaving blank for tests
          config: {},
          progress,
          is_boost_train: 0,
        };
      }
        break;
      case 'Progressed': {
        const sourceSelect = form.elements['hypeTrainSource'];
        const source = sourceSelect.options[sourceSelect.selectedIndex].text;
        const [name, userID] = await getNameFromInput(form.elements.hypeTrainName);
        const amount = parseInt(form.elements['hypeTrainAmount'].value) || 10;
        data = {
          sequence_id: 2174,
          user_profile_image_url: 'https://static-cdn.jtvnw.net/custom-reward-images/default-4.png',
          user_id: userID,
          user_display_name: name,
          user_login: name.toLowerCase(),
          source,
          progress,
          is_boost_train: 0,
          quantity: amount || 10,
        };
      }
        break;
      case 'Updated': {
        const [name, userID] = await getNameFromInput(form.elements.hypeTrainName);
        const sourceSelect = form.elements['hypeTrainSource'];
        const source = sourceSelect.options[sourceSelect.selectedIndex].text;
        const particType = source === 'BITS' ? particTypes[getRandomInt(0, 2)] : particTypes[getRandomInt(3, 8)];
        const particTypeValue = parseInt(form.elements['hypeTrainAmount'].value) || 10;
        baseObj = {
          display_name: name,
          user_name: name.toLowerCase(),
          user_id: userID,
        };
        data = {
          participations: {
            [particType]: particTypeValue,
          },
          source,
          user: {
            profile_image_url: 'https://static-cdn.jtvnw.net/custom-reward-images/default-4.png',
            id: userID,
            display_name: name,
            login: name.toLowerCase(),
          },
        };
      }
        break;
      case 'Leveled Up':
        data = {
          progress,
          time_to_expire: Date.now() + getRandomInt(10000, 300000),
          is_boost_train: 0,
        };
        break;
      case 'Ended': {
        const reasonSelect = form.elements['hypeTrainEndReason'];
        const reason = reasonSelect.options[reasonSelect.selectedIndex].text;
        baseObj = {
          ending_reason: reason,
        };
        data = {
          ending_reason: reason,
          ended_at: Date.now(),
          is_boost_train: 0,
        };
      }
        break;
      case 'Cooldown Expired': {
        // not sure what Pubsub sends for this event
        data = {};
      }
    }

    baseObj.type = typeNum;
    baseObj.data = data;

    sendTriggerToSAMMI(
      17,
      `Hype Train ${type} [test trigger] fired!`,
      { type: typeNum },
      baseObj,
    );
  },
    async SAMMITestTwitchChat(form) {
    const [name, userID] = await getNameFromInput(form.elements['name']);
    const message = form.elements['chatMsg'].value || SAMMI.generateMessage();
    const channel = Math.floor(Math.random() * 1000000000).toString();
    const color = '189A8D';
    const emoteList = '304822798:0-9/304682444:11-19';
    const firstTime = form.elements['chatFirstTime'].checked ? '1' : '0';
    const badge = [];
    if (form.elements['chatBroadcaster'].checked) badge.push('broadcaster/1');
    if (form.elements['chatMod'].checked) badge.push('moderator/1');
    if (form.elements['chatVip'].checked) badge.push('vip/1');
    if (form.elements['chatFounder'].checked) badge.push('founder/1');
    if (form.elements['chatSub'].checked) {
        const tier = parseInt(form.elements['chatMsgSubTier'].value);
        let month = form.elements['chatMsgSubMonth'].value != 1 ? parseInt(form.elements['chatMsgSubMonth'].value) : 0;
        month = month > 3 && month < 6
        ? (month = 3)
        : month > 6 && month < 9
          ? (month = 6)
          : month > 9 && month < 12
            ? (month = 9)
            : month;
        const subBadge = tier === 1
        ? `subscriber/${month}`
        : tier === 2
          ? `subscriber/${2000 + month}`
          : `subscriber/${3000 + month}`;
      badge.push(subBadge);
    }

    const pullData = {
      user_name: name.toLowerCase(),
      display_name: name,
      user_id: userID,
      message,
      emote_list: emoteList,
      badge_list: badge.join(','),
      channel,
      name_color: color,
      first_time: firstTime,
      from_channel_id: 123456789,
    };
    SAMMI.trigger(0, {
      message,
      user_name: name.toLowerCase(),
      broadcaster: form.elements['chatBroadcaster'].checked,
      moderator: form.elements['chatMod'].checked,
      sub: form.elements['chatSub'].checked,
      vip: form.elements['chatVip'].checked,
      founder: form.elements['chatFounder'].checked,
      trigger_data: pullData,
    });
  }

,
    async SAMMITestTwitchShoutout(form) {
    const [name, userID] = await getNameFromInput(form.elements.name);
    const pullData = {
      id: '33426a33-0454-4e00-a9ad-4ee5ca74d75d',
      user_name: name.toLowerCase(),
      display_name: name,
      user_id: userID,
      name_color: '',
      picture_url: 'https://static-cdn.jtvnw.net/user-default-pictures-uv/dbdc9198-def8-11e9-8681-784f43822e80-profile_image-300x300.png',
      recent_categories: '',
    };
    sendTriggerToSAMMI(
      28,
      `Shoutout to ${pullData.display_name}! [test trigger]`,
      {},
      pullData,
    );
  }
  
  };

  class ConstructPullData {
    constructor(type) {
      const name = generateName();
      this.user_name = name[0].toLowerCase();
      this.display_name = type !== 'SAMMITestTwitchBits' ? name[0] : undefined;
      this.user_id = name[1];
      this.addvalues = (params) => {
        Object.assign(this, params);
      };
    }
  }

  const forms = document.querySelectorAll('.SAMMITestTriggers');
  Array.prototype.slice.call(forms).forEach((form) => {
    form.addEventListener(
      'submit',
      (e) => {
        e.preventDefault();
        const pullData = new ConstructPullData(form.id);
        processTrigger[form.id](form, pullData);
      },
      false,
    );
  });

  async function getNameFromInput(input) {
  let name; let userID;
  if (input.value.length > 0) {
    name = input.value;
    userID = await getUserID(name)
      .catch((e) => name = e);
  } else {
    [name, userID] = generateName();
  }
  return [name, userID];
}

  async function getUserID(username) {
    const defaultID = 76159058;
    const response = await fetch(`https://decapi.me/twitch/id/${username}`)
      .catch(() => { throw defaultID; });
    const tryToGetID = await response.text();
    if (tryToGetID.indexOf('User not found') === -1) return tryToGetID;
    return defaultID;
  }
  function generateName(name = '') {
    const names = [
      ['Melonax', '41809329'],
      ['RamsReef', '91464575'],
      ['Wellzish', '461898318'],
      ['Andilippi', '47504449'],
      ['Cyanidesugar', '76159058'],
      ['Silverlink', '489730'],
      ['wolbee', '72573038'],
      ['Davidihewlett', '116807809'],
      ['DearAsMax', '478335805'],
      ['Estudiando_Ajedrez', '184806573'],
      ['RoadieGamer', '450427842'],
      ['chrizzz_1508', '88246295'],
      ['MisterK_Qc', '475765680'],
      ['Falinere', '144606537'],
      ['Landie', '78949799'],
      ['Phat32', '24565497'],
      ['mofalkmusic', '443568234'],
      ['NikiYanagi', '528140333'],
    ];
    const randomName = names[Math.floor(Math.random() * names.length)];
    if (name !== randomName) return randomName;
    return generateName(name);
  }
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * ((max + 1) - min) + min);
  }
  // split a total amount into several parts
function* splitNParts(num, parts) {
  let sumParts = 0;
  for (let i = 0; i < parts - 1; i++) {
    const pn = Math.ceil(Math.random() * (num - sumParts));
    yield pn;
    sumParts += pn;
  }
  yield num - sumParts;
}

  function populateWithChoiceInfo(obj, amount, type, allowBits, allowPoints, voteTotal) {
  // split total votes into parts for each choice
  const choiceVotesSplit = [...splitNParts(voteTotal, amount)];
  const topVotes = { ...choiceVotesSplit };
  const topVotesSorted = Object.keys(topVotes).sort((a, b) => parseInt(topVotes[b]) - parseInt(topVotes[a]));
  obj.top_vote_list = topVotesSorted;

  for (let i = 0; i < amount; i++) {
    const choiceInfo = {};
    const choiceInfoVotes = {};
    const choiceInfoTokens = {};
    const baseValue = 0;
    // fill all possible fields with 0 base value
    ['percentage', 'total_voters'].forEach((val) => choiceInfo[val] = baseValue);
    ['base', 'bits', 'channel_points', 'total'].forEach((val) => choiceInfoVotes[val] = baseValue);
    ['bits', 'channel_points'].forEach((val) => choiceInfoTokens[val] = baseValue);
    choiceInfo.choice_id = `ddb2f066-1e36-4099-a71b-50621f90b${i}cd`;
    choiceInfo.title = `Test Choice ${i + 1}`;
    if (type !== 'Created' && choiceVotesSplit[i] !== 0) {
      // split into base, bits and points votes amount based on total choice votes
      const choiceVotesTypeSplit = (allowBits && allowPoints) ? [...splitNParts(choiceVotesSplit[i], 3)] : (allowBits || allowPoints) ? [...splitNParts(choiceVotesSplit[i], 0), 0] : [choiceVotesSplit[i], 0, 0];
      choiceInfo.percentage = parseInt((choiceVotesSplit[i] / voteTotal) * 100);
      // total voters will be the same as total votes if no bits or points are enabled
      choiceInfo.total_voters = (allowBits || allowPoints) ? getRandomInt(choiceVotesSplit[i], choiceVotesSplit[i] / 10) : choiceVotesSplit[i];
      // populate the different vote types based on if bits and points are enabled or not
      choiceInfoVotes.total = choiceVotesSplit[i];
      choiceInfoVotes.base = choiceVotesTypeSplit[0];
      choiceInfoVotes.bits = allowBits ? choiceVotesTypeSplit[1] : 0;
      choiceInfoVotes.channel_points = allowPoints ? choiceVotesTypeSplit[2] || choiceVotesTypeSplit[1] : 0;
      // tokens are when someone votes with 5 channel points, they get 1 vote and 5 tokens?
      choiceInfoTokens.bits = allowBits ? choiceInfoVotes.bits * 5 : 0;
      choiceInfoTokens.channel_points = allowPoints ? choiceInfoVotes.channel_points * 10 : 0;
      // add up all the base, bits and channel points botes
      obj.vote_total_base += choiceInfoVotes.base;
      obj.vote_total_bits += choiceInfoVotes.bits;
      obj.vote_total_points += choiceInfoVotes.channel_points;
    }
    choiceInfo.votes = choiceInfoVotes;
    choiceInfo.tokens = choiceInfoTokens;
    obj[`choice_${i + 1}_info`] = choiceInfo;
  }
  return obj;
}

  function populateWithOutcomeInfo(obj, amount, type) {
  const voteTotal = (type !== 'Created') ? getRandomInt(amount, amount * 50) : 0;
  // split total votes into parts for each outcome
  const outcomeVotesSplit = [...splitNParts(voteTotal, amount)];
  // create all outcome objects
  for (let i = 0; i < amount; i++) {
    const total_points = outcomeVotesSplit[i];
    // total users are less or equal total votes
    const total_user = total_points !== 0 ? getRandomInt(Math.ceil(total_points / 10), total_points) : 0;
    // avoid having NaN if 0
    const percentage = total_points !== 0 ? parseInt((total_points / voteTotal) * 100) : 0;
    const outcome = {
      total_points, percentage, total_user, id: `e960f614-d379-494a-8b45-0c7500978${i}ea`, name: `Test Choice ${i + 1}`,
    };
    obj[`outcome_${i + 1}_info`] = outcome;
  }
  obj.vote_total = voteTotal;
  return obj;
}

  function generateUUID() {
  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) => (
    c
        ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))
  ).toString(16));
}

  function sendTriggerToSAMMI(
  type,
  message = 'Test trigger fired.',
  data = {},
  triggerData,
) {
  data.trigger_data = triggerData;
  SAMMI.testTrigger(type, data);
  SAMMI.alert(message);
}


}

function YTLiveTestEvent() {
  class ConstructPullData {
    constructor(id) {
      [this.display_name, this.user_id, this.picture_url] = generateName();
      this.addvalues = (params) => {
        Object.assign(this, params);
      };
      this.id = id;
    }
  }

  const buttonIds = [
    'ytLiveTestSub',
    'ytLiveTestMember',
    'ytLiveTestMilestone',
    'ytLiveTestSuperChat',
    'ytLiveTestSuperSticker',
    'ytLiveTestChatMessage'
  ];

  buttonIds.forEach(id => {
    const button = document.getElementById(id);
    const pullData = new ConstructPullData(id);

    button.addEventListener('click', () => {
      switch (pullData.id) {
        case 'ytLiveTestSub': ytLiveTestSub(pullData)
          break;
        case 'ytLiveTestMember': ytLiveTestMember(pullData)
          break;
        case 'ytLiveTestMilestone': ytLiveTestMilestone(pullData)
          break;
        case 'ytLiveTestSuperChat': ytLiveTestSuperChat(pullData)
          break;
        case 'ytLiveTestSuperSticker': ytLiveTestSuperSticker(pullData)
          break;
        case 'ytLiveTestChatMessage': ytLiveTestChatMessage(pullData)
          break;
        default:
          break;
      }
    });
  });

  // Assuming your include statements can be placed here
  function ytLiveTestSub(pullData) {
  sendTriggerToSAMMI(
    19,
    `YouTube Subscription [test trigger] triggered by ${pullData.display_name}`,
    {},
    pullData,
  );
}

  function ytLiveTestMember(pullData) {
  pullData.addvalues({
    channel_url: `https://www.youtube.com/channel/${pullData.user_id}`,
    chat_id: 'e5LT2xEURi9BQzf2rLe5eB3325081929219850',
    level_name: 'Some level name',
  });

  sendTriggerToSAMMI(
    22,
    `YouTube Member [test trigger] triggered by ${pullData.display_name}`,
    {},
    pullData,
  );
}

  function ytLiveTestMilestone(pullData) {
  const months = document.getElementById('YTLiveMilestoneMonth').value || Math.ceil(Math.random() * 10);
  const level_name = document.getElementById('YTLiveMilestoneLevel').value || 'Some level name';
  const message = document.getElementById('YTLiveMilestoneMsg').value || SAMMI.generateMessage();

  pullData.addvalues({
    channel_url: `https://www.youtube.com/channel/${pullData.user_id}`,
    chat_id: 'e5LT2xEURi9BQzf2rLe5eB3325081929219850',
    level_name,
    message,
    months,
  });

  sendTriggerToSAMMI(
    22,
    `YouTube Member Renewal [test trigger] triggered by ${pullData.display_name}`,
    {},
    pullData,
  );
}

  function ytLiveTestSuperChat(pullData) {
  const amount = parseInt(document.getElementById('YTLiveSuperChatAmount').value) || Math.ceil(Math.random() * 1000000);
  const tier = document.getElementById('YTLiveSuperChatTier').value || Math.ceil(Math.random() * 5);
  const message = document.getElementById('YTLiveSuperChatMsg').value || SAMMI.generateMessage();

  pullData.addvalues({
    channel_url: `https://www.youtube.com/channel/${pullData.user_id}`,
    chat_id: 'e5LT2xEURi9BQzf2rLe5eB3325081929219850',
    amount,
    amount_as_string: `${amount}`,
    currency: 'USD',
    message,
    tier,
  });

  sendTriggerToSAMMI(
    20,
    `YouTube Super Chat [test trigger] triggered by ${pullData.display_name}`,
    { amount },
    pullData,
  );
}

  function ytLiveTestSuperSticker(pullData) {
  const amount = parseInt(document.getElementById('YTLiveSuperStickerAmount').value) || Math.ceil(Math.random() * 1000000);

  pullData.addvalues({
    channel_url: `https://www.youtube.com/channel/${pullData.user_id}`,
    chat_id: 'e5LT2xEURi9BQzf2rLe5eB3325081929219850',
    amount,
    amount_as_string: `${amount}`,
    currency: 'USD',
    sticker_id: 'pearfect_hey_you_v2',
    sticker_text: 'Pear character turning around waving his hand, saying Hey you while lowering his glasses',
  });

  sendTriggerToSAMMI(
    21,
    `YouTube Super Sticker [test trigger] triggered by ${pullData.display_name}`,
    { amount },
    pullData,
  );
}

  function ytLiveTestChatMessage(pullData) {
  const message = document.getElementById('YTLiveChatMessageMsg').value || SAMMI.generateMessage();
  pullData.addvalues({
    display_name: document.getElementById('YTLiveChatMessageName').value || pullData.display_name,
    channel_url: `https://www.youtube.com/channel/${pullData.user_id}`,
    chat_id: 'e5LT2xEURi9BQzf2rLe5eB3325081929219850',
    message: message.replace(/"/g, "'"),
    is_broadcaster: YTLiveChatMessageBroadcaster.checked,
    is_moderator: YTLiveChatMessageMod.checked,
    is_member: YTLiveChatMessageMember.checked,
    is_verified: YTLiveChatMessageVerified.checked,
  });

  sendTriggerToSAMMI(
    18,
    `YouTube Chat Message Test triggered by ${pullData.display_name}`,
    {
      broadcaster: YTLiveChatMessageBroadcaster.checked,
      moderator: YTLiveChatMessageMod.checked,
      verified: YTLiveChatMessageVerified.checked,
      sponsor: YTLiveChatMessageMember.checked,
      message,
    },
    pullData,
  );
}


  function generateName() {
    const names = [
      ['RoadieGamer', 'UCvuULk4cLyoXHuraLDUkEpA', 'https://yt3.ggpht.com/9Mg_T4R3Po1LMKod4RcLL82x6NiZj4xFt1ztuX6hmJhvp_gAlSmExejepwLuH2V7Wj8klJbG=s88-c-k-c0x00ffffff-no-rj'],
      ['SilverLink', 'UCnXFNHXAmerjr5RLvlX4ojw', 'https://yt3.ggpht.com/96qVz0pLVJHB5NVCYdjLYAWNvcEl4zXH9UukPh3F_gv2a7aTdkIg6SQ2-L4fLGnSXhz_WN5GvA=s88-c-k-c0x00ffffff-no-rj'],
      ['Rams Reef', 'UCeSb7sLzpb7OVVzGe07AcHA', 'https://yt3.ggpht.com/ytc/AKedOLRpXf-yfyFyrfOJ9rdrCDDSR6PbMDgn1v0fs912=s88-c-k-c0x00ffffff-no-rj'],
      ['Cyanidesugar', 'UCnifImIxwoE9BalbaWlRuVg', 'https://yt3.ggpht.com/ytc/AKedOLRqNadDTDkEa-Nlz8UCNVvxK9hykksk1XVXhjgD=s88-c-k-c0x00ffffff-no-rj'],
      ['Wolbee', 'UC6e9OkB4njOHdN7jn9QYNRg', 'https://yt3.ggpht.com/_LK_RuWL5-mx2rK8foKYfNmpFlCRjkgbDChTUoxBf8xDwh9hgDqDDT5mmKJ-risI4qjIuYTe3w=s88-c-k-c0x00ffffff-no-rj'],
      ['chrizzz_1508', 'UCgs5H0txAV59us-H_xaysFw', 'https://yt3.ggpht.com/dMFvS0Z4jqWi9nuHW_Oin7xTwITC0pog7XJ9aIH7XKKkk4OjoBw_EH1J_iGy4X67X52A58gypQ=s88-c-k-c0x00ffffff-no-rj'],
      ['Mr.Rubber Ducky', 'UCM-wHpDJhBXQXO4Pq4SnusA', 'https://yt3.ggpht.com/q5SJkgteZVlcNNZQLUvCb5kirAEMkZPK2ADMeEY5sc97PpGngkx-mHiNOb9_bRyv46QKkIE_5w=s88-c-k-c0x00ffffff-no-rj'],
      ['Falinere', 'UCDf53fZZjoMIq-T0yOxEAIA', 'https://yt3.ggpht.com/ytc/AKedOLSC7rJLJF4kHQYguvZA37NLrVgGb_OQAJb6uCBkIQ=s88-c-k-c0x00ffffff-no-rj'],
      ['Waldo & Friends', 'UCwxgRi2IFqlYVTneamjrESA', 'https://yt3.ggpht.com/ytc/AKedOLQDlThoavf6_zR7WmRUM4GB0Bg_t8QpJ2jbEi8D=s88-c-k-c0x00ffffff-no-rj'],
      ['Landie', 'UC1FayVR82EazSlBS37sosrw', 'https://yt3.ggpht.com/ytc/AKedOLTgoUIiOsrTEEsGJEXgyQ1MkXmVOFrOjnUARQc_iw=s88-c-k-c0x00ffffff-no-rj'],
      ['Flipstream', 'UCEKVFoETu3cCBjqV8v4Z6uQ', 'https://yt3.ggpht.com/ScwqNhrC8CSzp3J6Nr2rGgFupPa4BrN3Kuq3gUJkYtqJxTbXPYv0alhk8qlaIa6oUOCGoDvo=s88-c-k-c0x00ffffff-no-rj'],
      ['griddark', 'UCn9zd0-RuMBZKE7u_myGtgA', 'https://yt3.ggpht.com/ytc/AKedOLSoo-kdU6msTEX46Wn7Q_TxGgzYgaO1hsvCzydz5Q=s88-c-k-c0x00ffffff-no-rj'],
      ['JimmyPotatoTV', 'UClxlbZo0-zHZcBIMOr4M4cQ', 'https://yt3.ggpht.com/ytc/AKedOLQVW4K8CXv4e_vDORLji4_2avIgYQ9FQkRpuXcv=s88-c-k-c0x00ffffff-no-rj'],
      ['Lyfesaver', 'UCqrv6kYkEfA2Rw_XGI3klWg', 'https://yt3.ggpht.com/ytc/AKedOLR5iCHlcCIkUSfcf-j4HcgV-Mh3V5rb3E7PfQae=s88-c-k-c0x00ffffff-no-rj'],
      ['MisterK', 'UCQFLW-RwDB7y4KE55Kqnsyg', 'https://yt3.ggpht.com/WHMcGQDTARCDKQyfIK4-K7Pm5xYVpp29A9D7qjIK9HQW1qDmNvHzc1Gk742FuVqCfYnbIn2Gjw=s88-c-k-c0x00ffffff-no-rj'],
      ['Sebas', 'UCQxIfBhgKD7YN2Gp8txd8GA', 'https://yt3.ggpht.com/ytc/AKedOLS6O3rx4NMuVngFSN_5mktw5LyT424zsS_jQIWd=s88-c-k-c0x00ffffff-no-rj'],
    ];
    const randomName = names[Math.floor(Math.random() * names.length)];
    return randomName;
  }
  function sendTriggerToSAMMI(
  type,
  message = 'Test trigger fired.',
  data = {},
  triggerData,
) {
  data.trigger_data = triggerData;
  SAMMI.testTrigger(type, data);
  SAMMI.alert(message);
}

}

// Function to get version from HTML content
async function getVersionFromHTML() {
// Get the content of the page\
  // Initialize bridgeVersion as not found
  let bridgeVersion = 'Bridge Version Not Found';
  const versionLine = document.firstChild.nextSibling.textContent;
  const versionRegex = /V([\d.]+)/;
  const match = versionRegex.exec(versionLine);

  if (match && match[1]) {
    [, bridgeVersion] = match;
  }
  // Use the bridge version
  document.querySelector('span[name="version"]').innerText = bridgeVersion;
}

(function initDebugLogging() {
  const dbgBridgeEl = document.getElementById('dbgBridge');
  dbgBridgeEl.checked = SAMMIVars.SAMMIdebug.core;
  // call SAMMiDebugLog when the checkbox is clicked
  dbgBridgeEl.onclick = () => SAMMIDebugLog(dbgBridgeEl);
  SAMMIDebugLog(dbgBridgeEl);
}())

function SAMMIDebugLog(e) {
  const core = document.getElementById('SAMMIcorelog');
  const listening = '<samp>Listening for traffic.</samp>';
  const disabled = '<samp>Logging is disabled.</samp>';
  // disable or enable debug logging and display it

  if (e.checked) {
    if (localStorage.debug === 'sammi-websocket-js:*') {
      const _debug = console.debug.bind(console);
      logIt = function (...args) {
        const msg = {};
        _debug.apply(console, arguments);
        if (!SAMMIdebugPost) return;
        Object.assign(msg, args[args.length - 2]);
        if (args[0].includes('Sending Message')) SAMMIdebugPost('coreSent', msg);
        else if (args[0].includes('Message received')) {
          SAMMIdebugPost('core', msg);
        }
      };
      window.logIt = logIt;
      core.innerHTML = listening;
    } else {
      core.innerHTML = '<samp>Logging will be enabled once SAMMI Bridge is reloaded.</samp>';
    }
    localStorage.debug = 'sammi-websocket-js:*';
  } else {
    if (localStorage.debug == 0) core.innerHTML = disabled;
    else {
      core.innerHTML = '<samp>Logging will be disabled once SAMMI Bridge is reloaded.</samp>';
    }
    logIt = null;
    localStorage.debug = 0;
  }
  SAMMIVars.SAMMIdebug.core = !!(e.checked);
  localStorage.setItem('SAMMIdebug', JSON.stringify(SAMMIVars.SAMMIdebug));
}

function SAMMIdebugPost(type, msg) {
  const p = SAMMIVars;
  if (!p.SAMMIdebug) return;
  const corelog = document.getElementById('SAMMIcorelog');
  const arrowDown = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-arrow-down" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/> </svg>';
  const arrowUp = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="green" class="bi bi-arrow-up" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/> </svg>';

  // post a message into the debug log if enabled
  if (p.SAMMIdebug.core) {
    const request = msg.rq || msg.upd;
    const { id } = msg;
    try {
      delete msg.id; delete msg.rq;
    } catch (e) {}
    if (request === 'Pong' || request === 'Ping' || msg.upd === 'Ping') return;
    if (msg.rq) {
      corelog.innerHTML += `<br> ${type === 'core' ? arrowUp : arrowDown} <samp>Request: ${request}, Id: ${id}, Data: ${StringifyandReplace(msg)} </samp>`;
    } else {
      corelog.innerHTML += `<br> ${type === 'core' ? arrowUp : arrowDown} <samp>Update: ${request}, Data: ${StringifyandReplace(msg)} </samp>`;
    }
  }

  // stringify if message is an object and replace some symbols
  // for better readability
  function StringifyandReplace(obj) {
    const regexToken = /"token":"[^"]*"/ig;
    if (typeof obj === 'object') obj = JSON.stringify(obj);
    const strRpl = (typeof obj === 'string') ? obj.replace(/\r\n/g, '').replace(/\\/g, '').replace(/\\/g, '').replace(/%s/g, '')
      .replace(/%o/g, '')
      .replace(/%c/g, '')
      .replace(regexToken, '"token":"xxxxxhidden"')
      : obj;
    return strRpl;
  }
}

})();

function sendExtensionCommands() {
// You SAMMI Core extension commands will be inserted here
/*INSERT PART 2*/
}
function SammiExtensionReceived(hook, SAMMIJSON) {
  let LioranBoardJSON = SAMMIJSON;
  switch (hook) {
    // hook you specified.
    default:
      break;
    //You hooks will be inserted here
    /*INSERT PART 3*/
  }
}
// Your main script will be inserted here
/*INSERT PART 4*/
</script>
<script src="https://cdn.jsdelivr.net/gh/SAMMISolutions/SAMMI-Websocket@main/dist/sammi-websocket.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@shopify/draggable@1.0.0-beta.11/lib/draggable.bundle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
  integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js" integrity="sha512-uXal8CICQ52UxoF9A3yBP6GUXGu5N2IoTZf/YXGMW4M0AvNyViA0ZjpGf9uqRpkN4kyx41Y5I0DmTQNOS6G05A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/obs-websocket-js@4.0.2/dist/obs-websocket.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/SAMMISolutions/SAMMI-Bridge@main/lib/obs-websocket5.min.js"></script>
</body>
</html>